---
### DO NOT EDIT! Generated by script/update-book2.rb
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: ru
  chapter:
    title: Инструменты Git
    number: 7
  section:
    title: Интерактивное индексирование
    number: 2
    cs_number: '7.2'
    previous: book/ru/v2/Инструменты-Git-Выбор-ревизии
    next: book/ru/v2/Инструменты-Git-Припрятывание-и-очистка
title: Git - Интерактивное индексирование
url: "/book/ru/v2/Инструменты-Git-Интерактивное-индексирование.html"
---
<h2 id="r_interactive_staging">Интерактивное индексирование</h2>
<div class="paragraph">
<p>Git поставляется вместе со скриптами, которые упрощают выполнение некоторых задач из командной строки.
В этом разделе мы рассмотрим несколько интерактивных команд, которые могут упростить создание коммитов, позволяя включать в них только определённый набор файлов и их частей.
Эти инструменты очень полезны, если вы изменили множество файлов, а затем решили, что хотите чтобы эти изменения были в нескольких маленьких понятных коммитах, а не в одном большом и запутанном.
Таким способом вы сможете гарантировать, что ваши коммиты представляют логически разделённые изменения и могут быть легко прорецензированы вашими коллегами.</p>
</div>
<div class="paragraph">
<p>Если вы выполните <code>git add</code> с опцией <code>-i</code> или <code>--interactive</code>, Git перейдёт в интерактивный консольный режим, отобразив что-то подобное:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git add -i
           staged     unstaged path
  1:    unchanged        +0/-1 TODO
  2:    unchanged        +1/-1 index.html
  3:    unchanged        +5/-1 lib/simplegit.rb

*** Commands ***
  1: [s]tatus     2: [u]pdate      3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff        7: [q]uit       8: [h]elp
What now&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вы можете видеть, что эта команда показывает вашу область подготовленных изменений в уникальном представлении — вообще говоря, ту же информацию вы получите с помощью команды <code>git status</code>, но несколько более сжато и информативно.
Эта команда показывает проиндексированные изменения слева, а непроиндексированные — справа.</p>
</div>
<div class="paragraph">
<p>Затем следует раздел со списком команд.
С их помощью вы можете выполнить множество вещей — добавить или исключить файлы из индекса, добавить в индекс части файлов, добавить в индекс неотслеживаемые файлы и просмотреть проиндексированные изменения.</p>
</div>
<div class="sect3">
<h3 id="_добавление_и_удаление_файлов_из_индекса">Добавление и удаление файлов из индекса</h3>
<div class="paragraph">
<p>Если вы введёте <code>2</code> или <code>u</code> в поле ввода <code>What now&gt;</code>, скрипт спросит у вас какие файлы вы хотите добавить в индекс:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">What now&gt; u
           staged     unstaged path
  1:    unchanged        +0/-1 TODO
  2:    unchanged        +1/-1 index.html
  3:    unchanged        +5/-1 lib/simplegit.rb
Update&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для добавления в индекс файлов TODO и index.html, вы можете ввести их номера:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">Update&gt;&gt; 1,2
           staged     unstaged path
* 1:    unchanged        +0/-1 TODO
* 2:    unchanged        +1/-1 index.html
  3:    unchanged        +5/-1 lib/simplegit.rb
Update&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Символ <code>*</code> у каждого из этих файлов означает, что файл выбран для индексирования.
Если вы нажмёте Enter, не вводя ничего в поле ввода <code>Update&gt;&gt;</code>, Git добавит в индекс всё, чтобы было выбрано ранее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">Update&gt;&gt;
updated 2 paths

*** Commands ***
  1: [s]tatus     2: [u]pdate      3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff        7: [q]uit       8: [h]elp
What now&gt; s
           staged     unstaged path
  1:        +0/-1      nothing TODO
  2:        +1/-1      nothing index.html
  3:    unchanged        +5/-1 lib/simplegit.rb</code></pre>
</div>
</div>
<div class="paragraph">
<p>Как вы можете заметить, сейчас файлы TODO и index.html добавлены в индекс, а файл simplegit.rb всё ещё нет.
Если вы в этот момент хотите исключить файл TODO из индекса, вы можете использовать опции <code>3</code> или <code>r</code> (для выполнения revert):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">*** Commands ***
  1: [s]tatus     2: [u]pdate      3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff        7: [q]uit       8: [h]elp
What now&gt; r
           staged     unstaged path
  1:        +0/-1      nothing TODO
  2:        +1/-1      nothing index.html
  3:    unchanged        +5/-1 lib/simplegit.rb
Revert&gt;&gt; 1
           staged     unstaged path
* 1:        +0/-1      nothing TODO
  2:        +1/-1      nothing index.html
  3:    unchanged        +5/-1 lib/simplegit.rb
Revert&gt;&gt; [enter]
reverted one path</code></pre>
</div>
</div>
<div class="paragraph">
<p>Посмотрев снова на состояние вашего рабочего каталога Git, вы увидите, что файл <code>TODO</code> исключён из индекса:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">*** Commands ***
  1: [s]tatus     2: [u]pdate      3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff        7: [q]uit       8: [h]elp
What now&gt; s
           staged     unstaged path
  1:    unchanged        +0/-1 TODO
  2:        +1/-1      nothing index.html
  3:    unchanged        +5/-1 lib/simplegit.rb</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для того, чтобы посмотреть изменения, которые вы добавили в индекс, вы можете использовать команду <code>6</code> и <code>d</code> (для выполнения diff).
Она покажет вам список добавленных в индекс файлов, и вы можете выбрать один из них, для которого вы хотите увидеть добавленные в индекс изменения.
Это очень похоже на вывод команды <code>git diff --cached</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">*** Commands ***
  1: [s]tatus     2: [u]pdate      3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff        7: [q]uit       8: [h]elp
What now&gt; d
           staged     unstaged path
  1:        +1/-1      nothing index.html
Review diff&gt;&gt; 1
diff --git a/index.html b/index.html
index 4d07108..4335f49 100644
--- a/index.html
+++ b/index.html
@@ -16,7 +16,7 @@ Date Finder

 &lt;p id="out"&gt;...&lt;/p&gt;

-&lt;div id="footer"&gt;contact : support@github.com&lt;/div&gt;
+&lt;div id="footer"&gt;contact : email.support@github.com&lt;/div&gt;

 &lt;script type="text/javascript"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Использование этих основных команд в интерактивном режиме команды add, может упростить вам работу с вашей областью подготовленных изменений.</p>
</div>
</div>
<div class="sect3">
<h3 id="_индексирование_по_частям">Индексирование по частям</h3>
<div class="paragraph">
<p>В Git существует возможность индексировать не только файлы целиком, но и некоторые их части.
Например, если вы сделали в файле simplegit.rb два изменения и хотите добавить в индекс только одно из них, добиться этого в Git очень легко.
В поле ввода в режиме интерактивного индексирования введите <code>5</code> или <code>p</code> (для выполнения patch).
Git спросит у вас какие файлы вы хотите добавить в индекс частично; а затем для каждой части выбранных файлов он будет показывать изменения в ней и спрашивать хотите ли вы добавить в индекс эту часть:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">diff --git a/lib/simplegit.rb b/lib/simplegit.rb
index dd5ecc4..57399e0 100644
--- a/lib/simplegit.rb
+++ b/lib/simplegit.rb
@@ -22,7 +22,7 @@ class SimpleGit
   end

   def log(treeish = 'master')
-    command("git log -n 25 #{treeish}")
+    command("git log -n 30 #{treeish}")
   end

   def blame(path)
Stage this hunk [y,n,a,d,/,j,J,g,e,?]?</code></pre>
</div>
</div>
<div class="paragraph">
<p>В этой точке у вас есть множество вариантов дальнейших действий.
Если вы введёте <code>?</code>, Git отобразит, что именно вы можете сделать:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">Добавить в индекс эту часть [y,n,a,d,/,j,J,g,e,?]? ?
y - добавить в индекс эту часть
n - не добавлять в индекс эту часть
a - добавить в индекс эту и все оставшиеся в этом файле части
d - не добавлять в индекс эту и все оставшиеся в этом файле части
g - перейти к некоторой части файла (g - показывает список частей и затем выполняет переход, g&lt;N&gt; - перейти к части N)
/ - найти часть, соответствующую регулярному выражению
j - отложить принятие решения по этой части, перейти к следующей части, решение по которой не принято
J - отложить принятие решения по этой части, перейти к следующей части
k - отложить принятие решения по этой части, перейти к предыдущей части, решение по которой не принято
K - отложить принятие решения по этой части, перейти к предыдущей части
s - разбить текущую часть на части меньшего размера
e - вручную отредактировать текущую часть
? - отобразить помощь</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обычно вы будете вводить <code>y</code> или <code>n</code>, если вы хотите индексировать каждую часть по отдельности, но индексация всех частей в некоторых файлах или откладывание решения по индексацию части также может быть полезным.
Если вы добавили в индекс одну часть файла, но не добавили другую, состояние вашего рабочего каталога будет подобно приведённому далее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">What now&gt; 1
           staged     unstaged path
  1:    unchanged        +0/-1 TODO
  2:        +1/-1      nothing index.html
  3:        +1/-1        +4/-0 lib/simplegit.rb</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание на состояние файла <code>simplegit.rb</code>.
Оно говорит вам, что часть строк файла добавлена в индекс, а часть нет.
Таким образом, вы частично проиндексировали этот файл.
В данный момент вы можете выйти из интерактивного режима команды <code>git add</code> и выполнить <code>git commit</code>, чтобы зафиксировать частично проиндексированные файлы.</p>
</div>
<div class="paragraph">
<p>Также вам не обязательно находиться в интерактивном режиме индексирования файлов для выполнения частичной индексации файлов — вы также можете запустить её, используя команды <code>git add -p</code> или <code>git add --patch</code>.</p>
</div>
<div class="paragraph">
<p>Более того, вы можете использовать работу с отдельными частями файлов для частичного восстановления файлов с помощью команды <code>reset --patch</code>, для переключения частей файлов с помощью команды <code>checkout --patch</code> и для припрятывания частей файлов с помощью <code>stash save --patch</code>.
Мы рассмотрим каждую из этих команд более подробно, когда будем изучать более продвинутые варианты их использования.</p>
</div>
</div>
<div id="nav"><a href="{{< previous-section >}}">prev</a> | <a href="{{< next-section >}}">next</a></div>