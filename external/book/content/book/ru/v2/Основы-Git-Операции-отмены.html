---
### DO NOT EDIT! Generated by script/update-book2.rb
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: ru
  chapter:
    title: Основы Git
    number: 2
  section:
    title: Операции отмены
    number: 4
    cs_number: '2.4'
    previous: book/ru/v2/Основы-Git-Просмотр-истории-коммитов
    next: book/ru/v2/Основы-Git-Работа-с-удалёнными-репозиториями
title: Git - Операции отмены
url: "/book/ru/v2/Основы-Git-Операции-отмены.html"
---
<h2 id="r_undoing">Операции отмены</h2>
<div class="paragraph">
<p>В любой момент вам может потребоваться что-либо отменить.
Здесь мы рассмотрим несколько основных способов отмены сделанных изменений.
Будьте осторожны, не все операции отмены в свою очередь можно отменить!
Это одна из редких областей Git, где неверными действиями можно необратимо удалить результаты своей работы.</p>
</div>
<div class="paragraph">
<p>Отмена может потребоваться, если вы сделали коммит слишком рано, например, забыв добавить какие-то файлы или комментарий к коммиту.
Если вы хотите переделать коммит — внесите необходимые изменения, добавьте их в индекс и сделайте коммит ещё раз, указав параметр <code>--amend</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git commit --amend</code></pre>
</div>
</div>
<div class="paragraph">
<p>Эта команда использует область подготовки (индекс) для внесения правок в коммит.
Если вы ничего не меняли с момента последнего коммита (например, команда запущена сразу после предыдущего коммита), то снимок состояния останется в точности таким же, а всё что вы сможете изменить — это ваше сообщение к коммиту.</p>
</div>
<div class="paragraph">
<p>Запустится тот же редактор, только он уже будет содержать сообщение предыдущего коммита.
Вы можете редактировать сообщение как обычно, однако, оно заменит сообщение предыдущего коммита.</p>
</div>
<div class="paragraph">
<p>Например, если вы сделали коммит и поняли, что забыли проиндексировать изменения в файле, который хотели добавить в коммит, то можно сделать следующее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git commit -m 'Initial commit'
$ git add forgotten_file
$ git commit --amend</code></pre>
</div>
</div>
<div class="paragraph">
<p>В итоге получится единый коммит — второй коммит заменит результаты первого.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
<div class="paragraph">
<p>Очень важно понимать, что когда вы вносите правки в последний коммит, вы не столько исправляете его, сколько <em>заменяете</em> новым, который полностью его перезаписывает.
В результате всё выглядит так, будто первоначальный коммит никогда не существовал, а так же он больше не появится в истории вашего репозитория.</p>
</div>
<div class="paragraph">
<p>Очевидно, смысл изменения коммитов в добавлении незначительных правок в последние коммиты и, при этом, в избежании засорения истории сообщениями вида «Ой, забыл добавить файл» или «Исправление грамматической ошибки».</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h3 id="r_unstaging">Отмена индексации файла</h3>
<div class="paragraph">
<p>Следующие два раздела демонстрируют как работать с индексом и изменениями в рабочем каталоге.
Радует, что команда, которой вы определяете состояние этих областей, также подсказывает вам как отменять изменения в них.
Например, вы изменили два файла и хотите добавить их в разные коммиты, но случайно выполнили команду <code>git add *</code> и добавили в индекс оба.
Как исключить из индекса один из них?
Команда <code>git status</code> напомнит вам:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git add *
$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD &lt;file&gt;..." to unstage)

    renamed:    README.md -&gt; README
    modified:   CONTRIBUTING.md</code></pre>
</div>
</div>
<div class="paragraph">
<p>Прямо под текстом «Changes to be committed» говорится: используйте <code>git reset HEAD &lt;file&gt;…​</code> для исключения из индекса.
Давайте последуем этому совету и отменим индексирование файла <code>CONTRIBUTING.md</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git reset HEAD CONTRIBUTING.md
Unstaged changes after reset:
M	CONTRIBUTING.md
$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD &lt;file&gt;..." to unstage)

    renamed:    README.md -&gt; README

Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)

    modified:   CONTRIBUTING.md</code></pre>
</div>
</div>
<div class="paragraph">
<p>Команда выглядит несколько странно, но — работает!
Файл <code>CONTRIBUTING.md</code> изменен, но больше не добавлен в индекс.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
<div class="paragraph">
<p>Команда <code>git reset</code> <em>может</em> быть опасной если вызвать её с параметром <code>--hard</code>.
В приведённом примере файл не был затронут, следовательно команда относительно безопасна.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>На текущий момент этот магический вызов — всё, что вам нужно знать о команде <code>git reset</code>.
Мы рассмотрим в деталях что именно делает <code>reset</code> и как с её помощью делать действительно интересные вещи в разделе <a href="{{< relurl "book/ru/v2/ch00/r_git_reset" >}}">Раскрытие тайн reset</a> главы 7.</p>
</div>
</div>
<div class="sect3">
<h3 id="_отмена_изменений_в_файле">Отмена изменений в файле</h3>
<div class="paragraph">
<p>Что делать, если вы поняли, что не хотите сохранять свои изменения файла <code>CONTRIBUTING.md</code>?
Как можно просто отменить изменения в нём — вернуть к тому состоянию, которое было в последнем коммите (или к начальному после клонирования, или ещё как-то полученному)?
Нам повезло, что <code>git status</code> подсказывает и это тоже.</p>
</div>
<div class="paragraph">
<p>В выводе команды из последнего примера список изменений выглядит примерно так:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)

    modified:   CONTRIBUTING.md</code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь явно сказано как отменить существующие изменения.
Давайте так и сделаем:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git checkout -- CONTRIBUTING.md
$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD &lt;file&gt;..." to unstage)

    renamed:    README.md -&gt; README</code></pre>
</div>
</div>
<div class="paragraph">
<p>Как видите, откат изменений выполнен.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Важно</div>
</td>
<td class="content">
<div class="paragraph">
<p>Важно понимать, что <code>git checkout -- &lt;file&gt;</code> — опасная команда.
Все локальные изменения в файле пропадут — Git просто заменит его версией из последнего коммита.
Ни в коем случае не используйте эту команду, если вы не уверены, что изменения в файле вам не нужны.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Если вы хотите сохранить изменения в файле, но прямо сейчас их нужно отменить, то есть способы получше, такие как ветвление и припрятывание — мы рассмотрим их в главе <a href="{{< relurl "book/ru/v2/ch00/ch03-git-branching" >}}">Ветвление в Git</a>.</p>
</div>
<div class="paragraph">
<p>Помните, всё что попало в <em>коммит</em> почти всегда Git может восстановить.
Можно восстановить даже коммиты из веток, которые были удалены, или коммиты, перезаписанные параметром <code>--amend</code> (см. <a href="{{< relurl "book/ru/v2/ch00/r_data_recovery" >}}">Восстановление данных</a>).
Но всё, что не было включено в коммит и потеряно — скорее всего, потеряно навсегда.</p>
</div>
</div>
<div class="sect3">
<h3 id="undoing_git_restore">Отмена действий с помощью git restore</h3>
<div class="paragraph">
<p>Git версии 2.23.0 представил новую команду: <code>git restore</code>.
По сути, это альтернатива git reset, которую мы только что рассмотрели.
Начиная с версии 2.23.0, Git будет использовать <code>git restore</code> вместо <code>git reset</code> для многих операций отмены.</p>
</div>
<div class="paragraph">
<p>Давайте проследим наши шаги и отменим действия с помощью <code>git restore</code> вместо <code>git reset</code>.</p>
</div>
<div class="sect4">
<h4 id="_отмена_индексации_файла_с_помощью_git_restore">Отмена индексации файла с помощью git restore</h4>
<div class="paragraph">
<p>В следующих двух разделах показано, как работать с индексом и изменениями рабочей копии с помощью <code>git restore</code>.
Приятно то, что команда, которую вы используете для определения состояния этих двух областей, также напоминает вам, как отменить изменения в них.
Например, предположим, что вы изменили два файла и хотите зафиксировать их как два отдельных изменения, но случайно набираете <code>git add *</code> и индексируете их оба.
Как вы можете убрать из индекса один из двух?
Команда <code>git status</code> напоминает вам:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git add *
$ git status
On branch master
Changes to be committed:
  (use "git restore --staged &lt;file&gt;..." to unstage)
	modified:   CONTRIBUTING.md
	renamed:    README.md -&gt; README</code></pre>
</div>
</div>
<div class="paragraph">
<p>Прямо под текстом «Changes to be committed», написано использовать <code>git restore --staged &lt;file&gt; …​</code> для отмены индексации файла.
Итак, давайте воспользуемся этим советом, чтобы убрать из индекса файл <code>CONTRIBUTING.md</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git restore --staged CONTRIBUTING.md
$ git status
On branch master
Changes to be committed:
  (use "git restore --staged &lt;file&gt;..." to unstage)
	renamed:    README.md -&gt; README

Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git restore &lt;file&gt;..." to discard changes in working directory)
	modified:   CONTRIBUTING.md</code></pre>
</div>
</div>
<div class="paragraph">
<p>Файл <code>CONTRIBUTING.md</code> изменен, но снова не индексирован.</p>
</div>
</div>
<div class="sect4">
<h4 id="_откат_изменённого_файла_с_помощью_git_restore">Откат изменённого файла с помощью git restore</h4>
<div class="paragraph">
<p>Что, если вы поймёте, что не хотите сохранять изменения в файле <code>CONTRIBUTING.md</code>?
Как легко его откатить — вернуть обратно к тому, как он выглядел при последнем коммите (или изначально клонирован, или каким-либо образом помещён в рабочий каталог)?
К счастью, <code>git status</code> тоже говорит, как это сделать.
В выводе последнего примера, неиндексированная область выглядит следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git restore &lt;file&gt;..." to discard changes in working directory)
	modified:   CONTRIBUTING.md</code></pre>
</div>
</div>
<div class="paragraph">
<p>Он довольно недвусмысленно говорит, как отменить сделанные вами изменения.
Давайте сделаем то, что написано:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git restore CONTRIBUTING.md
$ git status
On branch master
Changes to be committed:
  (use "git restore --staged &lt;file&gt;..." to unstage)
	renamed:    README.md -&gt; README</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Важно</div>
</td>
<td class="content">
<div class="paragraph">
<p>Важно понимать, что <code>git restore &lt;file&gt;</code> — опасная команда.
Любые локальные изменения, внесённые в этот файл, исчезнут — Git просто заменит файл последней зафиксированной версией.
Никогда не используйте эту команду, если точно не знаете, нужны ли вам эти несохранённые локальные изменения.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div id="nav"><a href="{{< previous-section >}}">prev</a> | <a href="{{< next-section >}}">next</a></div>