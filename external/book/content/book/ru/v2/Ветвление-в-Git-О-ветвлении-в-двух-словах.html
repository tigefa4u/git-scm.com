---
### DO NOT EDIT! Generated by script/update-book2.rb
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: ru
  chapter:
    title: Ветвление в Git
    number: 3
  section:
    title: О ветвлении в двух словах
    number: 1
    cs_number: '3.1'
    previous: book/ru/v2/Основы-Git-Заключение
    next: book/ru/v2/Ветвление-в-Git-Основы-ветвления-и-слияния
title: Git - О ветвлении в двух словах
url: "/book/ru/v2/Ветвление-в-Git-О-ветвлении-в-двух-словах.html"
---
<p>
Почти каждая система контроля версий в той или иной форме поддерживает ветвление.
Используя ветвление, Вы отклоняетесь от основной линии разработки и продолжаете работу независимо от неё, не вмешиваясь в основную линию.
Во многих системах контроля версий создание веток — это очень затратный процесс, часто требующий создания новой копии каталога с исходным кодом, что может занять много времени для большого проекта.</p><p>Некоторые люди, говоря о модели ветвления Git, называют её «киллер-фича», что выгодно выделяет Git на фоне остальных систем контроля версий.
Что в ней такого особенного?
Ветвление Git очень легковесно: операция создания ветки выполняется почти мгновенно, переключение между ветками туда-сюда, обычно, также быстро.
В отличие от многих других систем контроля версий, Git поощряет процесс работы, при котором ветвление и слияние выполняется часто, даже по несколько раз в день.
Понимание и владение этой функциональностью даёт вам уникальный и мощный инструмент, который может полностью изменить привычный процесс разработки.</p>
<h2 id="r_git_branches_overview">О ветвлении в двух словах</h2>
<div class="paragraph">
<p>Для точного понимания механизма ветвлений, необходимо вернуться назад и изучить то, как Git хранит данные.</p>
</div>
<div class="paragraph">
<p>Как вы можете помнить из <a href="{{< relurl "book/ru/v2/ch00/what_is_git_section" >}}">Что такое Git?</a>, Git не хранит данные в виде последовательности изменений, он использует набор снимков (snapshot).</p>
</div>
<div class="paragraph">
<p>Когда вы делаете коммит, Git сохраняет его в виде объекта, который содержит указатель на снимок (snapshot) подготовленных данных.
Этот объект так же содержит имя автора и email, сообщение и указатель на коммит или коммиты непосредственно предшествующие данному (его родителей): отсутствие родителя для первоначального коммита, один родитель для обычного коммита, и несколько родителей для результатов слияния двух и более веток.</p>
</div>
<div class="paragraph">
<p>Предположим, у вас есть каталог с тремя файлами и вы добавляете их все в индекс и создаёте коммит.
Во время индексации вычисляется контрольная сумма каждого файла (SHA-1 как мы узнали из <a href="{{< relurl "book/ru/v2/ch00/what_is_git_section" >}}">Что такое Git?</a>), затем каждый файл сохраняется в репозиторий (Git называет такой файл <em>блоб</em> — большой бинарный объект), а контрольная сумма попадёт в индекс:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git add README test.rb LICENSE
$ git commit -m 'Initial commit'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Когда вы создаёте коммит командой <code>git commit</code>, Git вычисляет контрольные суммы каждого подкаталога (в нашем случае, только основной каталог проекта) и сохраняет его в репозитории как объект дерева каталогов.
Затем Git создаёт объект коммита с метаданными и указателем на основное дерево проекта для возможности воссоздать этот снимок в случае необходимости.</p>
</div>
<div class="paragraph">
<p>Ваш репозиторий Git теперь хранит пять объектов: три блоб объекта (по одному на каждый файл), объект <em>дерева</em> каталогов, содержащий список файлов и соответствующих им блобов, а так же объект <em>коммита</em>, содержащий метаданные и указатель на объект дерева каталогов.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ru/v2/images/commit-and-tree.png" >}}" alt="Коммит и его дерево">
</div>
<div class="title">Рисунок 9. Коммит и его дерево</div>
</div>
<div class="paragraph">
<p>Если вы сделаете изменения и создадите ещё один коммит, то он будет содержать указатель на предыдущий коммит.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ru/v2/images/commits-and-parents.png" >}}" alt="Коммит и его родители">
</div>
<div class="title">Рисунок 10. Коммит и его родители</div>
</div>
<div class="paragraph">
<p>Ветка в Git — это простой перемещаемый указатель на один из таких коммитов.
По умолчанию, имя основной ветки в Git — <code>master</code>.
Как только вы начнёте создавать коммиты, ветка <code>master</code> будет всегда указывать на последний коммит.
Каждый раз при создании коммита указатель ветки <code>master</code> будет передвигаться на следующий коммит автоматически.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ветка «master» в Git — это не какая-то особенная ветка.
Она точно такая же, как и все остальные ветки.
Она существует почти во всех репозиториях только лишь потому, что её создаёт команда <code>git init</code>, а большинство людей не меняют её название.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ru/v2/images/branch-and-history.png" >}}" alt="Ветка и история коммитов">
</div>
<div class="title">Рисунок 11. Ветка и история коммитов</div>
</div>
<div class="sect3">
<h3 id="r_create_new_branch">Создание новой ветки</h3>
<div class="paragraph">
<p>
Что же на самом деле происходит при создании ветки?
Всего лишь создаётся новый указатель для дальнейшего перемещения.
Допустим вы хотите создать новую ветку с именем <code>testing</code>.
Вы можете это сделать командой <code>git branch</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git branch testing</code></pre>
</div>
</div>
<div class="paragraph">
<p>В результате создаётся новый указатель на текущий коммит.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ru/v2/images/two-branches.png" >}}" alt="Две ветки указывают на одну и ту же последовательность коммитов">
</div>
<div class="title">Рисунок 12. Две ветки указывают на одну и ту же последовательность коммитов</div>
</div>
<div class="paragraph">
<p>Как Git определяет, в какой ветке вы находитесь?
Он хранит специальный указатель <code>HEAD</code>.
Имейте ввиду, что в Git концепция <code>HEAD</code> значительно отличается от других систем контроля версий, которые вы могли использовать раньше (Subversion или CVS).
В Git — это указатель на текущую локальную ветку.
В нашем случае мы всё ещё находимся в ветке <code>master</code>.
Команда <code>git branch</code> только <em>создаёт</em> новую ветку, но не переключает на неё.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ru/v2/images/head-to-master.png" >}}" alt="HEAD указывает на ветку">
</div>
<div class="title">Рисунок 13. HEAD указывает на ветку</div>
</div>
<div class="paragraph">
<p>Вы можете легко это увидеть при помощи простой команды <code>git log</code>, которая покажет вам куда указывают указатели веток.
Эта опция называется <code>--decorate</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git log --oneline --decorate
f30ab (HEAD -&gt; master, testing) Add feature #32 - ability to add new formats to the central interface
34ac2 Fix bug #1328 - stack overflow under certain conditions
98ca9 Initial commit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь можно увидеть указывающие на коммит <code>f30ab</code> ветки: <code>master</code> и <code>testing</code>.</p>
</div>
</div>
<div class="sect3">
<h3 id="r_switching_branches">Переключение веток</h3>
<div class="paragraph">
<p>
Для переключения на существующую ветку выполните команду <code>git checkout</code>.
Давайте переключимся на ветку <code>testing</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git checkout testing</code></pre>
</div>
</div>
<div class="paragraph">
<p>В результате указатель <code>HEAD</code> переместится на ветку <code>testing</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ru/v2/images/head-to-testing.png" >}}" alt="HEAD указывает на текущую ветку">
</div>
<div class="title">Рисунок 14. HEAD указывает на текущую ветку</div>
</div>
<div class="paragraph">
<p>Какой в этом смысл?
Давайте сделаем ещё один коммит:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ vim test.rb
$ git commit -a -m 'made a change'</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ru/v2/images/advance-testing.png" >}}" alt="Указатель на ветку HEAD переместился вперёд после коммита">
</div>
<div class="title">Рисунок 15. Указатель на ветку HEAD переместился вперёд после коммита</div>
</div>
<div class="paragraph">
<p>Интересная ситуация: указатель на ветку <code>testing</code> переместился вперёд, а <code>master</code> указывает на тот же коммит, где вы были до переключения веток командой <code>git checkout</code>.
Давайте переключимся назад на ветку <code>master</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git checkout master</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
<div class="title">
<code>git log</code> не показывает все ветки по умолчанию</div>
<div class="paragraph">
<p>Если выполнить команду <code>git log</code> прямо сейчас, то в её выводе только что созданная ветка «testing» фигурировать не будет.</p>
</div>
<div class="paragraph">
<p>Ветка никуда не исчезла; просто Git не знает, что именно она вас интересует, и выводит наиболее полезную по его мнению информацию.
Другими словами, по умолчанию <code>git log</code> отобразит историю коммитов только для текущей ветки.</p>
</div>
<div class="paragraph">
<p>Для просмотра истории коммитов другой ветки необходимо явно указать её имя: <code>git log testing</code>
Чтобы посмотреть историю по всем веткам — выполните команду с дополнительным флагом: <code>git log --all</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ru/v2/images/checkout-master.png" >}}" alt="HEAD перемещается когда вы делаете checkout">
</div>
<div class="title">Рисунок 16. HEAD перемещается когда вы делаете checkout</div>
</div>
<div class="paragraph">
<p>Эта команда сделала две вещи: переместила указатель <code>HEAD</code> назад на ветку <code>master</code> и вернула файлы в рабочем каталоге в то состояние, на снимок которого указывает <code>master</code>.
Это также означает, что все вносимые с этого момента изменения будут относиться к старой версии проекта.
Другими словами, вы откатили все изменения ветки <code>testing</code> и можете продолжать в другом направлении.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
<div class="title">Переключение веток меняет файлы в рабочем каталоге</div>
<div class="paragraph">
<p>Важно запомнить, что при переключении веток в Git происходит изменение файлов в рабочем каталоге.
Если вы переключаетесь на старую ветку, то рабочий каталог будет выглядеть так же, как выглядел на момент последнего коммита в ту ветку.
Если Git по каким-то причинам не может этого сделать — он не позволит вам переключиться вообще.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Давайте сделаем ещё несколько изменений и создадим очередной коммит:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ vim test.rb
$ git commit -a -m 'made other changes'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь история вашего проекта разошлась (см <a href="{{< relurl "book/ru/v2/ch00/rdivergent_history" >}}">Разветвлённая история</a>).
Вы создали ветку и переключились на неё, поработали, а затем вернулись в основную ветку и поработали в ней.
Эти изменения изолированы друг от друга: вы можете свободно переключаться туда и обратно, а когда понадобится — объединить их.
И всё это делается простыми командами: <code>branch</code>, <code>checkout</code> и <code>commit</code>.</p>
</div>
<div id="rdivergent_history" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ru/v2/images/advance-master.png" >}}" alt="Разветвлённая история">
</div>
<div class="title">Рисунок 17. Разветвлённая история</div>
</div>
<div class="paragraph">
<p>Все описанные действия можно визуализировать с помощью команды <code>git log</code>.
Для отображения истории коммитов, текущего положения указателей веток и истории ветвления выполните команду <code>git log --oneline --decorate --graph --all</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git log --oneline --decorate --graph --all
* c2b9e (HEAD, master) Made other changes
| * 87ab2 (testing) Made a change
|/
* f30ab Add feature #32 - ability to add new formats to the central interface
* 34ac2 Fix bug #1328 - stack overflow under certain conditions
* 98ca9 initial commit of my project</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ветка в Git — это простой файл, содержащий 40 символов контрольной суммы SHA-1 коммита, на который она указывает; поэтому операции с ветками являются дешёвыми с точки зрения потребления ресурсов или времени.
Создание новой ветки в Git происходит так же быстро и просто как запись 41 байта в файл (40 знаков и перевод строки).</p>
</div>
<div class="paragraph">
<p>Это принципиально отличает процесс ветвления в Git от более старых систем контроля версий, где все файлы проекта копируются в другой подкаталог.
В зависимости от размера проекта, операции ветвления в таких системах могут занимать секунды или даже минуты, когда в Git эти операции мгновенны.
Поскольку при коммите мы сохраняем указатель на родительский коммит, то поиск подходящей базы для слияния веток делается автоматически и, в большинстве случаев, очень прост.
Эти возможности побуждают разработчиков чаще создавать и использовать ветки.</p>
</div>
<div class="paragraph">
<p>Давайте посмотрим, почему и вам имеет смысл делать так же.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
<div class="title">Одновременное создание новой ветки и переключение на неё</div>
<div class="paragraph">
<p>Как правило, при создании новой ветки вы хотите сразу на неё переключиться — это можно сделать используя команду <code>git checkout -b &lt;newbranchname&gt;</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
<div class="paragraph">
<p>Начиная с Git версии 2.23, вы можете использовать <code>git switch</code> вместо <code>git checkout</code>, чтобы:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Переключиться на существующую ветку: <code>git switch testing-branch</code>.</p>
</li>
<li>
<p>Создать новую ветку и переключиться на неё: <code>git switch -c new-branch</code>.
Флаг <code>-c</code> означает создание, но также можно использовать полный формат:` --create`.</p>
</li>
<li>
<p>Вернуться к предыдущей извлечённой ветке: <code>git switch -</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div id="nav"><a href="{{< previous-section >}}">prev</a> | <a href="{{< next-section >}}">next</a></div>