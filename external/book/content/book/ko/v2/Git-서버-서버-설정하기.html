---
### DO NOT EDIT! Generated by script/update-book2.rb
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: ko
  chapter:
    title: Git 서버
    number: 4
  section:
    title: 서버 설정하기
    number: 4
    cs_number: '4.4'
    previous: book/ko/v2/Git-서버-SSH-공개키-만들기
    next: book/ko/v2/Git-서버-Git-데몬
title: Git - 서버 설정하기
url: "/book/ko/v2/Git-서버-서버-설정하기.html"
---
<h2 id="_setting_up_server">서버 설정하기</h2>
<div class="paragraph">
<p>서버에서 설정하는 일을 살펴보자.
일단 Ubuntu같은 표준 Linux 배포판을 사용한다고 가정한다.
사용자들은 아마도 <code>authorized_keys</code> 파일로 인증할 것이다.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">노트</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>ssh-copy-id</code> 명령을 사용하면 여기에서 설명하는 SSH 공개키를 복사하고 설치하는 내용을 자동화 한 도구이다.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>먼저 <code>git</code> 계정을 만들고 사용자 홈 디렉토리에 <code>.ssh</code> 디렉토리를 만든다:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ sudo adduser git
$ su git
$ cd
$ mkdir .ssh &amp;&amp; chmod 700 .ssh
$ touch .ssh/authorized_keys &amp;&amp; chmod 600 .ssh/authorized_keys</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>authorized_keys</code> 파일에 SSH 공개키를 추가해야 사용자가 접근할 수 있다.
추가하기 전에 이미 알고 있는 사람의 공개키를 받아서 가지고 있다고 가정한다.
공개키가 어떻게 생겼는지 다시 한번 확인하자.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cat /tmp/id_rsa.john.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCB007n/ww+ouN4gSLKssMxXnBOvf9LGt4L
ojG6rs6hPB09j9R/T17/x4lhJA0F3FR1rP6kYBRsWj2aThGw6HXLm9/5zytK6Ztg3RPKK+4k
Yjh6541NYsnEAZuXz0jTTyAUfrtU3Z5E003C4oxOj6H0rfIF1kKI9MAQLMdpGW1GYEIgS9Ez
Sdfd8AcCIicTDWbqLAcU4UpkaX8KyGlLwsNuuGztobF8m72ALC/nLF6JLtPofwFBlgc+myiv
O7TCUSBdLQlgMVOFq1I2uPWQOkOWQAHukEOmfjy2jctxSDBQ220ymjaNsHT4kgtZg2AYYgPq
dAv8JggJICUvax2T9va5 gsg-keypair</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>.ssh</code> 디렉토리에 있는 <code>authorized_keys</code> 파일에 추가한다:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cat /tmp/id_rsa.john.pub &gt;&gt; ~/.ssh/authorized_keys
$ cat /tmp/id_rsa.josie.pub &gt;&gt; ~/.ssh/authorized_keys
$ cat /tmp/id_rsa.jessica.pub &gt;&gt; ~/.ssh/authorized_keys</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>--bare</code> 옵션을 주고 <code>git init</code> 를 실행해서 워킹 디렉토리가 없는 빈 저장소를 하나 만든다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cd /srv/git
$ mkdir project.git
$ cd project.git
$ git init --bare
Initialized empty Git repository in /srv/git/project.git/</code></pre>
</div>
</div>
<div class="paragraph">
<p>이제 John, Josie, Jessica는 이 저장소를 리모트 저장소로 등록하고 나서 브랜치를 Push 할 수 있다.
프로젝트마다 적어도 한 명은 서버에 접속해서 Bare 저장소를 만들어야 한다.
<code>git</code> 계정과 저장소를 만든 서버의 호스트 이름이 <code>gitserver</code> 라고 하자.
만약 이 서버가 내부망에 있고 <code>gitserver</code> 가 그 서버를 가리키도록 DNS에 설정하면 아래와 같은 명령을 사용할 수 있다(<code>myproject</code> 프로젝트가 이미 있다고 가정한다).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console"># on John's computer
$ cd myproject
$ git init
$ git add .
$ git commit -m 'initial commit'
$ git remote add origin git@gitserver:/srv/git/project.git
$ git push origin master</code></pre>
</div>
</div>
<div class="paragraph">
<p>이제 이 프로젝트를 Clone 하고 나서 수정하고 Push 할 수 있다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git clone git@gitserver:/srv/git/project.git
$ cd project
$ vim README
$ git commit -am 'fix for the README file'
$ git push origin master</code></pre>
</div>
</div>
<div class="paragraph">
<p>이렇게 개발자들이 읽고 쓸 수 있는 Git 서버를 쉽게 만들 수 있다.</p>
</div>
<div class="paragraph">
<p>이 개발자들은 서버에 <code>git</code> 계정으로 로그인할 수 있다.
이를 막으려면 <code>passwd</code> 파일에서 로그인 셸을 바꿔야한다.</p>
</div>
<div class="paragraph">
<p>단순히 로그인 셸을 <code>git-shell</code> 로 바꾸기만 하면 <code>git</code> 계정으로는 <code>git</code> 만 사용할 수 있다.
이 로그인 셸은 서버의 다른 부분은 건들 수 없도록 돼있다.
<code>git-shell</code> 을 사용자의 로그인 셸로 지정해야 한다.
<code>/etc/shells</code> 에 <code>git-shell</code> 를 추가한다. 아래를 보자.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cat /etc/shells   # 이미 `git-shell` 이 등록돼 있는지 확인
$ which git-shell   # git-shell 실행파일이 설치돼 있는지 확인
$ sudo vim /etc/shells  # 바로 위 명령으로 확인한 git-shell 실행파일의 절대경로를 추가</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>chsh &lt;계정이름&gt; -s &lt;shell&gt;</code> 명령어를 이용해서 특정 계정의 셸을 바꿀 수 있다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ sudo chsh git  # git-shell 경로를 입력, 보통 /usr/bin/git-shell 임</code></pre>
</div>
</div>
<div class="paragraph">
<p>이제 <em>git</em> 계정으로 Push 와 Pull 할 수 있지만 서버의 셸은 가질 수 없다.
로그인하려고 하면 아래와 같이 로그인 불가능 메시지만 보게 될 것이다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ ssh git@gitserver
fatal: Interactive git shell is not enabled.
hint: ~/git-shell-commands should exist and have read and execute access.
Connection to gitserver closed.</code></pre>
</div>
</div>
<div class="paragraph">
<p>이제 Git은 제대로 동작하면서 개발자들이 셸을 얻지 못하게 되었다.
위의 출력에서 볼 수 있듯이 <code>git</code> 계정의 홈 디렉토리에 <code>git-shell-commands</code> 디렉토리를 만들어 <code>git-shell</code> 의 동작을 조금 바꿀 수 있다.
예를 들면 서버에서 사용할 수 있는 Git 명령어를 제한할 수 있다. 또 명령어를 실행했을 때 나오는 메시지도 변경 할 수 있다.
<code>git help shell</code> 명령어를 실행하면 Git 셸을 꾸미는 데에 필요한 정보를 얻을 수 있다. </p>
</div>
<div id="nav"><a href="{{< previous-section >}}">prev</a> | <a href="{{< next-section >}}">next</a></div>