---
### DO NOT EDIT! Generated by script/update-book2.rb
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: de
  chapter:
    title: 'Anhang B: Git in Ihre Anwendungen einbetten'
    number: 2
  section:
    title: Libgit2
    number: 2
    cs_number: A2.2
    previous: book/de/v2/Anhang-B:-Git-in-Ihre-Anwendungen-einbetten-Die-Git-Kommandozeile
    next: book/de/v2/Anhang-B:-Git-in-Ihre-Anwendungen-einbetten-JGit
title: Git - Libgit2
url: "/book/de/v2/Anhang-B:-Git-in-Ihre-Anwendungen-einbetten-Libgit2.html"
---
<h2 id="_libgit2">Libgit2</h2>
<div class="paragraph">
<p>
Eine weitere Möglichkeit, die Ihnen zur Verfügung steht, ist die Verwendung von Libgit2.
Mit Libgit2 ist eine von Abhängigkeiten freie Implementierung von Git, wobei der Schwerpunkt auf einer ansprechenden API zur Integration in andere Anwendungen liegt.
Sie finden das Programm unter <a href="https://libgit2.org" class="bare" target="_blank" rel="noopener">https://libgit2.org</a>.</p>
</div>
<div class="paragraph">
<p>Lassen Sie uns zunächst einen Blick auf die C-API werfen.
Hier ist eine schnelle Tour:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// Open a repository
git_repository *repo;
int error = git_repository_open(&amp;repo, "/path/to/repository");

// Dereference HEAD to a commit
git_object *head_commit;
error = git_revparse_single(&amp;head_commit, repo, "HEAD^{commit}");
git_commit *commit = (git_commit*)head_commit;

// Print some of the commit's properties
printf("%s", git_commit_message(commit));
const git_signature *author = git_commit_author(commit);
printf("%s &lt;%s&gt;\n", author-&gt;name, author-&gt;email);
const git_oid *tree_id = git_commit_tree_id(commit);

// Cleanup
git_commit_free(commit);
git_repository_free(repo);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Die ersten beiden Zeilen öffnen ein Git-Repository.
Der <code>git_repository</code> Typ repräsentiert einen Handle auf ein Repository mit Cache im Arbeitsspeicher.
Diese Methode ist die am einfachsten anzuwendende, wenn man den genauen Pfad zum Arbeitsverzeichnis oder zum <code>.git</code> Ordner eines Repositorys kennt.
Es gibt auch <code>git_repository_open_ext</code>, das Optionen für die Suche enthält, <code>git_clone</code> und seine Verwandten für das Erstellen eines lokalen Klons eines Remote-Repositorys und <code>git_repository_init</code> für das Erstellen eines völlig neuen Repositorys.</p>
</div>
<div class="paragraph">
<p>Der zweite Teil des Codes verwendet die <code>rev-parse</code> Syntax (siehe auch <a href="{{< relurl "book/de/v2/ch00/_branch_references" >}}">Branch Referenzen</a>), um den Commit zu erhalten, auf den HEAD letztlich zeigt.
Der zurückgegebene Typ ist ein <code>git_object</code> Pointer, der ein Objekt repräsentiert, das in der Git-Objekt-Datenbank für ein Repository steht.
Bei <code>git_object</code> handelt es sich eigentlich um einen „Parent“-Typ für mehrere verschiedene Arten von Objekten. Das Speicher-Layout für jeden der „Child“-Typen ist das Gleiche wie bei <code>git_object</code>, so dass Sie sicher auf den richtigen Typ verweisen können.
In diesem Fall würde <code>git_object_type(commit)</code> ein <code>GIT_OBJ_COMMIT</code> zurückgeben, so dass es sicher auf einen <code>git_commit</code> Pointer zu zeigt.</p>
</div>
<div class="paragraph">
<p>Der nächste Abschnitt zeigt, wie auf die Eigenschaften des Commits zugegriffen werden kann.
Die letzte Zeile, hier, verwendet einen <code>git_oid</code> Typ; das ist das Anzeige-Format von Libgit2 für einen SHA-1-Hash.</p>
</div>
<div class="paragraph">
<p>From this sample, a couple of patterns have started to emerge:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Wenn Sie einen Pointer definieren und ihm eine Referenz in einem Libgit2-Aufruf übergeben, wird dieser Aufruf wahrscheinlich einen ganzzahligen Fehlercode zurückgeben.
Ein Wert von <code>0</code> zeigt den Erfolg an; alles andere signalisiert einen Fehler.</p>
</li>
<li>
<p>Auch wenn Libgit2 einen Zeiger für Sie erstellt, Sie sind dafür verantwortlich, ihn freizugeben.</p>
</li>
<li>
<p>Wenn Libgit2 einen <code>const</code> Pointer aus einem Aufruf zurückgegeben hat, müssen Sie ihn nicht freigeben, aber er wird ungültig, wenn das Objekt, zu dem er gehört, freigegeben wird.</p>
</li>
<li>
<p>Das Schreiben in <strong>C</strong> kann ein bisschen mühselig sein.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>
Das letzte Argument bedeutet, dass es nicht sehr wahrscheinlich ist, dass Sie einen C-Code schreiben werden, wenn Sie Libgit2 verwenden.
Glücklicherweise gibt es eine Reihe von sprachspezifischen Anbindungen, die es ziemlich einfach machen, mit Git-Repositorys in Ihrer spezifischen Programmier-Sprache und -Umgebung zu arbeiten.
Schauen wir uns das obige Beispiel an, das mit den Ruby-Anbindungen für Libgit2 geschrieben wurde, die Rugged genannt werden und unter <a href="https://github.com/libgit2/rugged" class="bare" target="_blank" rel="noopener">https://github.com/libgit2/rugged</a> zu finden sind.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">repo = Rugged::Repository.new('path/to/repository')
commit = repo.head.target
puts commit.message
puts "#{commit.author[:name]} &lt;#{commit.author[:email]}&gt;"
tree = commit.tree</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wie Sie sehen können, ist der Code viel weniger verwirrend.
Erstens verwendet Rugged Ausnahmeregeln; es kann Dinge wie <code>ConfigError</code> oder <code>ObjectError</code> aktivieren, um so Fehlerzustände zu signalisieren.
Zweitens gibt es keine explizite Freigabe von Ressourcen, da in Ruby eine automatische Speicherbereinigung aktiv ist.
Schauen wir uns ein etwas komplexeres Beispiel an: einen Commit von Grund auf neu zu erstellen</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">blob_id = repo.write("Blob contents", :blob) # <b class="conum">(1)</b>

index = repo.index
index.read_tree(repo.head.target.tree)
index.add(:path =&gt; 'newfile.txt', :oid =&gt; blob_id) # <b class="conum">(2)</b>

sig = {
    :email =&gt; "bob@example.com",
    :name =&gt; "Bob User",
    :time =&gt; Time.now,
}

commit_id = Rugged::Commit.create(repo,
    :tree =&gt; index.write_tree(repo), # <b class="conum">(3)</b>
    :author =&gt; sig,
    :committer =&gt; sig, # <b class="conum">(4)</b>
    :message =&gt; "Add newfile.txt", # <b class="conum">(5)</b>
    :parents =&gt; repo.empty? ? [] : [ repo.head.target ].compact, # <b class="conum">(6)</b>
    :update_ref =&gt; 'HEAD', # <b class="conum">(7)</b>
)
commit = repo.lookup(commit_id) # <b class="conum">(8)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Einen neuen Blob erstellen, der den Inhalt einer neuen Datei enthält.</p>
</li>
<li>
<p>Ergänzen Sie den Index mit dem ersten Wert des Commit-Baums und fügen Sie die Datei im Pfad <code>newfile.txt</code> hinzu.</p>
</li>
<li>
<p>Damit wird ein neuer Baum in der Objektdatenbank (ODB) erstellt und für den neuen Commit verwendet.</p>
</li>
<li>
<p>Wir verwenden die gleiche Signatur für das Autoren- und das Committer-Feld.</p>
</li>
<li>
<p>Die Commit-Beschreibung.</p>
</li>
<li>
<p>Wenn Sie einen Commit erstellen, müssen Sie die Elternteile des neuen Commits angeben.
Dazu wird das Ende von HEAD für den einzelnen Elternteil verwendet.</p>
</li>
<li>
<p>Rugged (und Libgit2) können optional eine Referenz aktualisieren, wenn sie einen Commit erstellen.</p>
</li>
<li>
<p>Der Rückgabewert entspricht dem SHA-1-Hash eines neuen Commit-Objekts, mit dem Sie dann ein <code>Commit</code> Objekt erzeugen können.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Der Ruby-Code ist zwar ganz nett und klar und da Libgit2 die Ausführung übernimmt, wird dieser Code auch relativ schnell laufen.
Falls Sie kein Ruby-Anhänger sind, dann zeigen wir Alternativen in <a href="{{< relurl "book/de/v2/ch00/_libgit2_bindings" >}}">Andere Anbindungen</a>.</p>
</div>
<div class="sect3">
<h3 id="_erweiterte_funktionalität">Erweiterte Funktionalität</h3>
<div class="paragraph">
<p>Libgit2 verfügt über einige Funktionen, die nicht zum eigentlichen Umfang von Git gehören.
Ein Beispiel ist die Erweiterbarkeit: Libgit2 erlaubt es Ihnen, benutzerdefinierte „Backends“ für unterschiedliche Betriebsarten anzubieten, so dass Sie Dinge auf eine andere Art speichern können, als es mit Git möglich ist.
Libgit2 erlaubt benutzerdefinierte Backends unter anderem zum Konfigurieren, die Ref-Speicherung und für die Objektdatenbank.</p>
</div>
<div class="paragraph">
<p>Schauen wir uns an, wie das genau funktioniert.
Der untenstehende Code ist aus einer Reihe von Backend-Beispielen des Libgit2-Teams entlehnt (die unter <a href="https://github.com/libgit2/libgit2-backends" class="bare" target="_blank" rel="noopener">https://github.com/libgit2/libgit2-backends</a> zu finden sind).
So wird ein benutzerdefiniertes Backend für die Objektdatenbank eingerichtet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">git_odb *odb;
int error = git_odb_new(&amp;odb); // <b class="conum">(1)</b>

git_odb_backend *my_backend;
error = git_odb_backend_mine(&amp;my_backend, /*…*/); // <b class="conum">(2)</b>

error = git_odb_add_backend(odb, my_backend, 1); // <b class="conum">(3)</b>

git_repository *repo;
error = git_repository_open(&amp;repo, "some-path");
error = git_repository_set_odb(repo, odb); // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Beachten Sie, dass Fehler zwar erfasst, aber nicht bearbeitet werden. Wir hoffen, dass Ihr Code besser als unserer ist.</em></p>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Erzeugen einer leeren Objektdatenbank (ODB) „Frontend“, die als eine Art Container für die „Backends“ dient, mit denen die eigentliche Arbeit erledigt wird.</p>
</li>
<li>
<p>Ein benutzerdefiniertes ODB-Backend einrichten.</p>
</li>
<li>
<p>Das Backend dem Frontend hinzufügen.</p>
</li>
<li>
<p>Ein Repository öffnen und so einrichten, dass es unsere ODB zum Suchen von Objekten verwendet.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Aber was ist das für ein <code>git_odb_backend_mine</code>?
Nun, das ist der Konstruktor für Ihre eigene ODB-Implementation. Sie können dort machen, was immer Sie wollen, solange Sie die <code>git_odb_backend</code> Struktur richtig eingeben.
Hier sieht man, wie es ausschauen <em>könnte</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">typedef struct {
    git_odb_backend parent;

    // Some other stuff
    void *custom_context;
} my_backend_struct;

int git_odb_backend_mine(git_odb_backend **backend_out, /*…*/)
{
    my_backend_struct *backend;

    backend = calloc(1, sizeof (my_backend_struct));

    backend-&gt;custom_context = …;

    backend-&gt;parent.read = &amp;my_backend__read;
    backend-&gt;parent.read_prefix = &amp;my_backend__read_prefix;
    backend-&gt;parent.read_header = &amp;my_backend__read_header;
    // …

    *backend_out = (git_odb_backend *) backend;

    return GIT_SUCCESS;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Die wichtigste Bedingung dabei ist, dass das erste Element von <code>my_backend_struct</code> eine <code>git_odb_backend</code> Struktur sein muss. Dadurch wird sichergestellt, dass das Speicherlayout dem entspricht, was der Libgit2-Code erwartet.
Der restliche Teil ist beliebig. Diese Struktur kann so groß oder klein sein, wie Sie es brauchen.</p>
</div>
<div class="paragraph">
<p>Die Initialisierungsfunktion weist der Struktur Speicherplatz zu, richtet den benutzerdefinierten Kontext ein und fügt dann die Mitglieder der von ihr unterstützten <code>parent</code> Struktur ein.
Schauen Sie sich die Datei <code>include/git2/sys/odb_backend.h</code> im Libgit2-Quelltext an, um einen vollständigen Satz von Aufrufsignaturen zu erhalten. Ihr spezieller Anwendungszweck wird Ihnen helfen, zu bestimmen, welche dieser Signaturen Sie dann benötigen.</p>
</div>
</div>
<div class="sect3">
<h3 id="_libgit2_bindings">Andere Anbindungen</h3>
<div class="paragraph">
<p>Libgit2 hat Anbindungen für viele Programmier-Sprachen.
Hier zeigen wir eine kleine Auswahl der wichtigsten Pakete, die zum Zeitpunkt der Erstellung dieses Textes verfügbar waren. Es gibt Bibliotheken für viele andere Sprachen, darunter C++, Go, Node.js, Erlang und die JVM, die alle in unterschiedlich weit entwickelt sind.
Die offizielle Kollektion von Anbindungen kann in den Repositorys unter <a href="https://github.com/libgit2" class="bare" target="_blank" rel="noopener">https://github.com/libgit2</a> gefunden werden.
Der Code, den wir schreiben werden, wird die Commit-Nachricht des Commits zurückliefern, auf den HEAD letztlich zeigt (etwa so wie <code>git log -1</code>).</p>
</div>
<div class="sect4">
<h4 id="_libgit2sharp">LibGit2Sharp</h4>
<div class="paragraph">
<p>
Wenn Sie eine .NET- oder Mono-Anwendung schreiben, ist LibGit2Sharp (<a href="https://github.com/libgit2/libgit2sharp" class="bare" target="_blank" rel="noopener">https://github.com/libgit2/libgit2sharp</a>) das Richtige für Sie.
Die Anbindungen sind in C# geschrieben und es wurde große Sorgfalt darauf verwendet die unverarbeiteten Libgit2-Aufrufe in CLR-APIs mit der ursprünglichen Funktionalität zu verpacken.
So sieht unser Beispielprogramm aus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new Repository(@"C:\path\to\repo").Head.Tip.Message;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Für Windows-Desktop-Anwendungen gibt es außerdem ein NuGet-Paket, das Ihnen einen schnellen Einstieg ermöglicht.</p>
</div>
</div>
<div class="sect4">
<h4 id="_objective_git">objective-git</h4>
<div class="paragraph">
<p>
Wenn Ihre Anwendung auf einer Apple-Plattform läuft, verwenden Sie wahrscheinlich Objective-C als Programmiersprache.
Objective-Git (<a href="https://github.com/libgit2/objective-git" class="bare" target="_blank" rel="noopener">https://github.com/libgit2/objective-git</a>) ist der Name der Libgit2-Anbindungen für diese Umgebung.
Das Beispielprogramm sieht wie folgt aus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-objc" data-lang="objc">GTRepository *repo =
    [[GTRepository alloc] initWithURL:[NSURL fileURLWithPath: @"/path/to/repo"] error:NULL];
NSString *msg = [[[repo headReferenceWithError:NULL] resolvedTarget] message];</code></pre>
</div>
</div>
<div class="paragraph">
<p>Objective-git ist vollständig kompatibel mit Swift. Sie brauchen also keine Angst zu haben, wenn Sie Objective-C aufgegeben haben.</p>
</div>
</div>
<div class="sect4">
<h4 id="_pygit2">pygit2</h4>
<div class="paragraph">
<p>
Die Anbindungen für Libgit2 in Python heißen Pygit2 und sind unter <a href="https://www.pygit2.org" class="bare" target="_blank" rel="noopener">https://www.pygit2.org</a> zu finden.
Hier ist unser Beispielprogramm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">pygit2.Repository("/path/to/repo") # open repository
    .head                          # get the current branch
    .peel(pygit2.Commit)           # walk down to the commit
    .message                       # read the message</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h3 id="_weiterführende_informationen">Weiterführende Informationen</h3>
<div class="paragraph">
<p>Eine vollständige Beschreibung der Funktionen von Libgit2 liegt natürlich nicht im Rahmen dieses Buches.
Wenn Sie weitere Informationen über Libgit2 selbst wünschen, finden Sie eine API-Dokumentation unter <a href="https://libgit2.github.com/libgit2" class="bare" target="_blank" rel="noopener">https://libgit2.github.com/libgit2</a> und eine Reihe von Anleitungen unter <a href="https://libgit2.github.com/docs" class="bare" target="_blank" rel="noopener">https://libgit2.github.com/docs</a>.
Für die anderen Anbindungen schauen Sie sich das enthaltene README und die Tests an. Häufig gibt es auch kleine Tutorials und Hinweise zum Weiterlesen.</p>
</div>
</div>
<div id="nav"><a href="{{< previous-section >}}">prev</a> | <a href="{{< next-section >}}">next</a></div>