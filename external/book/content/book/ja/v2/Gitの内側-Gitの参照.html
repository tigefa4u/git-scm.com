---
### DO NOT EDIT! Generated by script/update-book2.rb
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: ja
  chapter:
    title: Gitの内側
    number: 10
  section:
    title: Gitの参照
    number: 3
    cs_number: '10.3'
    previous: book/ja/v2/Gitの内側-Gitオブジェクト
    next: book/ja/v2/Gitの内側-Packfile
title: Git - Gitの参照
url: "/book/ja/v2/Gitの内側-Gitの参照.html"
---
<h2 id="r_git_refs">Gitの参照</h2>
<div class="paragraph">
<p><code>git log 1a410e</code> のように実行すれば、すべての歴史に目を通すことができます。しかし、歴史を辿ってすべてのオブジェクトを探しだすには、 <code>1a410e</code> が最後のコミットであることを覚えていなければならないのは変わりません。
SHA-1ハッシュ値をシンプルな名前で保存できれば、生のSHA-1ハッシュ値ではなく、その名前をポインタとして使用できます。</p>
</div>
<div class="paragraph">
<p>Gitでは、これは “参照” ないしは “refs” と呼ばれます。 <code>.git/refs</code> ディレクトリを見ると、SHA-1ハッシュ値を含むファイルがあることが分かります。
現在のプロジェクトでは、このディレクトリにファイルはありませんが、シンプルな構成のディレクトリがあります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ find .git/refs
.git/refs
.git/refs/heads
.git/refs/tags
$ find .git/refs -type f</code></pre>
</div>
</div>
<div class="paragraph">
<p>参照を新しく作成して、最後のコミットがどこかを覚えやすくします。技術的には、以下のように簡単に行えます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ echo "1a410efbd13591db07496601ebc7a059dd55cfe9" &gt; .git/refs/heads/master</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、Gitコマンドで、SHA-1ハッシュ値の代わりに、たった今作成したhead参照（ブランチ）を使えるようになりました。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git log --pretty=oneline master
1a410efbd13591db07496601ebc7a059dd55cfe9 third commit
cac0cab538b970a37ea1e769cbbde608743bc96d second commit
fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</code></pre>
</div>
</div>
<div class="paragraph">
<p>参照ファイルを直接変更するのは推奨されません。
その代わり、参照をより安全に更新するためのコマンド <code>update-ref</code> が、Gitには用意されています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git update-ref refs/heads/master 1a410efbd13591db07496601ebc7a059dd55cfe9</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは、Gitにおいて、基本的にブランチとは一連の作業の先頭を指す単純なポインタや参照であるということを表しています。
2つ目のコミットが先頭になるブランチを作るには、次のようにします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git update-ref refs/heads/test cac0ca</code></pre>
</div>
</div>
<div class="paragraph">
<p>作成されたブランチは、さきほど指定したコミット以前の作業のみを含むことになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git log --pretty=oneline test
cac0cab538b970a37ea1e769cbbde608743bc96d second commit
fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</code></pre>
</div>
</div>
<div class="paragraph">
<p>この時点で、Gitのデータベースは概念的には以下の図のように見えます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/data-model-4.png" >}}" alt="ブランチのヘッドへの参照を含むGitディレクトリオブジェクト">
</div>
<div class="title">図 150. ブランチの先頭への参照を含むGitディレクトリオブジェクト</div>
</div>
<div class="paragraph">
<p><code>git branch (ブランチ名)</code> のようなコマンドを実行すると、あなたが作りたいと思っている新しい参照が何であれ、基本的にGitは <code>update-ref</code> コマンドを実行して、いま自分がいるブランチ上の最後のコミットのSHA-1ハッシュをその参照に追加します。</p>
</div>
<div class="sect3">
<h3 id="r_the_head">HEAD</h3>
<div class="paragraph">
<p>では、<code>git branch (ブランチ名)</code> を実行したときに、Gitはどうやって最後のコミットのSHA-1ハッシュを知るのでしょうか？
答えは、HEADファイルです。</p>
</div>
<div class="paragraph">
<p>HEADファイルは、現在作業中のブランチに対するシンボリック参照です。
通常の参照と区別する意図でシンボリック参照と呼びますが、これには、一般的にSHA-1ハッシュ値ではなく他の参照へのポインタが格納されています。
ファイルの中身を見ると、通常は以下のようになっています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cat .git/HEAD
ref: refs/heads/master</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>git checkout test</code> を実行すると、Git はこのようにファイルを更新します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cat .git/HEAD
ref: refs/heads/test</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>git commit</code> を実行するとコミットオブジェクトが作られますが、そのときコミットオブジェクトの親として、HEADが指し示す参照先のSHA-1ハッシュ値が指定されます。</p>
</div>
<div class="paragraph">
<p>このファイルを直に編集することもできますが、<code>symbolic-ref</code> と呼ばれる、編集を安全に行うためのコマンドが存在します。
このコマンドを使ってHEADの値を読み取ることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git symbolic-ref HEAD
refs/heads/master</code></pre>
</div>
</div>
<div class="paragraph">
<p>HEADの値を設定することもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git symbolic-ref HEAD refs/heads/test
$ cat .git/HEAD
ref: refs/heads/test</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>refs</code> の形式以外では、シンボリック参照を設定することはできません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git symbolic-ref HEAD test
fatal: Refusing to point HEAD outside of refs/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h3 id="_タグ">タグ</h3>
<div class="paragraph">
<p>これで Git の主要な三つのオブジェクトを見終わったわけですが、タグという4つ目のオブジェクトがあります。
タグオブジェクトは、コミットオブジェクトに非常によく似ており、タガー、日付、メッセージ、ポインタを格納しています。
主な違いは、タグオブジェクトは通常、ツリーではなくコミットを指しているということです。
タグオブジェクトはブランチに対する参照に似ていますが、決して変動しません – 常に同じコミットを指しており、より分かりやすい名前が与えられます。</p>
</div>
<div class="paragraph">
<p><a href="{{< relurl "book/ja/v2/ch00/ch02-git-basics" >}}">[ch02-git-basics]</a> で述べましたが、タグには2つのタイプがあります。軽量 (lightweight) 版と注釈付き (annotated) 版です。
次のように実行すると、軽量版のタグを作成できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git update-ref refs/tags/v1.0 cac0cab538b970a37ea1e769cbbde608743bc96d</code></pre>
</div>
</div>
<div class="paragraph">
<p>これが軽量版のタグのすべてです。つまり決して変動しない参照なのです。
一方、注釈付き版のタグはもっと複雑です。
注釈付き版のタグを作ろうとすると、Gitはタグオブジェクトを作った上で、コミットを直接指す参照ではなく、そのタグを指す参照を書き込みます。
注釈付き版のタグを作ると、これが分かります（ <code>-a</code> オプションで、注釈付き版のタグを作るよう指定しています）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git tag -a v1.1 1a410efbd13591db07496601ebc7a059dd55cfe9 -m 'test tag'</code></pre>
</div>
</div>
<div class="paragraph">
<p>作られたオブジェクトのSHA-1ハッシュ値はこうなります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cat .git/refs/tags/v1.1
9585191f37f7b0fb9444f35a9bf50de191beadc2</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで、そのSHA-1ハッシュ値に対して <code>cat-file</code> コマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git cat-file -p 9585191f37f7b0fb9444f35a9bf50de191beadc2
object 1a410efbd13591db07496601ebc7a059dd55cfe9
type commit
tag v1.1
tagger Scott Chacon &lt;schacon@gmail.com&gt; Sat May 23 16:48:58 2009 -0700

test tag</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>object</code> の項目が、上でタグ付けしたコミットのSHA-1ハッシュ値を指していることに注意してください。
また、この項目が必ずしもコミットだけをポイントするものではないことも覚えておいてください。あらゆるGitオブジェクトに対してタグを付けることができます。
例えば Git のソースコードリポジトリでは、メンテナが自分のGPG公開鍵をブロブオブジェクトとして追加し、そのオブジェクトにタグを付けています。
Gitリポジトリのクローン上で、以下のコマンドを実行すると公開鍵を閲覧できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git cat-file blob junio-gpg-pub</code></pre>
</div>
</div>
<div class="paragraph">
<p>Linux カーネルのリポジトリもまた、<code>object</code> 項目でコミット以外を指しているタグオブジェクトを持っています。
これは最初のタグオブジェクトであり、最初にソースコードをインポートしたときの初期ツリーオブジェクトを指しています。</p>
</div>
</div>
<div class="sect3">
<h3 id="_リモート">リモート</h3>
<div class="paragraph">
<p>これから見ていく3つ目の参照のタイプはリモート参照です。
リモートを追加してそこにプッシュすると、Gitはそのリモートへ最後にプッシュした値を、ブランチ毎に <code>refs/remotes</code> へ格納します。
例えば、 <code>origin</code> というリモートを追加して、そこに <code>master</code> ブランチをプッシュしたとします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git remote add origin git@github.com:schacon/simplegit-progit.git
$ git push origin master
Counting objects: 11, done.
Compressing objects: 100% (5/5), done.
Writing objects: 100% (7/7), 716 bytes, done.
Total 7 (delta 2), reused 4 (delta 1)
To git@github.com:schacon/simplegit-progit.git
  a11bef0..ca82a6d  master -&gt; master</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで <code>refs/remotes/origin/master</code> ファイルの中身を確認してみてください。最後にサーバーと通信したときに <code>origin</code> リモートの <code>master</code> ブランチが何であったかがわかるはずです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cat .git/refs/remotes/origin/master
ca82a6dff817ec66f44342007202690a93763949</code></pre>
</div>
</div>
<div class="paragraph">
<p>リモート参照は、特に読み取り専用とみなされる点において、ブランチ（<code>refs/heads</code> にある参照）とは異なります。
リモート参照に対して <code>git checkout</code> を行うことはできますが、GitはHEADの参照先をそのリモートにすることはなく、したがって <code>commit</code> コマンドでリモートを更新することもできません。
Gitはリモート参照を一種のブックマークとして管理します。つまり、最後に通信したとき、向こうのサーバー上でリモートブランチが置かれていた状態を指し示すブックマークということです。</p>
</div>
</div>
<div id="nav"><a href="{{< previous-section >}}">prev</a> | <a href="{{< next-section >}}">next</a></div>