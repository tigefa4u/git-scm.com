---
### DO NOT EDIT! Generated by script/update-book2.rb
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: ja
  chapter:
    title: GitHub
    number: 6
  section:
    title: プロジェクトへの貢献
    number: 2
    cs_number: '6.2'
    previous: book/ja/v2/GitHub-アカウントの準備と設定
    next: book/ja/v2/GitHub-プロジェクトのメンテナンス
title: Git - プロジェクトへの貢献
url: "/book/ja/v2/GitHub-プロジェクトへの貢献.html"
---
<h2 id="_プロジェクトへの貢献">プロジェクトへの貢献</h2>
<div class="paragraph">
<p>これでアカウントが用意できたので、次は、既存のプロジェクトへの貢献にあたって役立つであろうことを説明していきましょう。</p>
</div>
<div class="sect3">
<h3 id="_プロジェクトのフォーク">プロジェクトのフォーク</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>既存のプロジェクトに貢献したいけれども、そのリポジトリにプッシュする権限がないという場合は、プロジェクトを「フォーク」できます。
「フォーク」するとは、GitHub があなた専用にそのプロジェクトのコピーを作るということです。あなた自身の名前空間に置かれるので、そこには自分でプッシュできます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注記</div>
</td>
<td class="content">
<div class="paragraph">
<p>歴史的に、この「フォーク」という用語はあまり好ましくない意味で使われてきました。
何かのオープンソースプロジェクトの方針を気に入らない人が、別の道を歩み出すこと
（そして時には、競合するプロジェクトを作って、貢献者を引き抜いてしまうこと）を指していたのです。
GitHub における「フォーク」とは、単にあなたの配下に作られるコピー以外の何者でもありません。
自分自身による変更を公開の場でそのプロジェクトに適用でき、よりオープンなやりかたでプロジェクトに貢献できるようにするための手段なのです。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>この方式なら、協力してくれる人たちにいちいちプッシュアクセス権を付与していく必要はありません。
それぞれがプロジェクトをフォークして、そこにプッシュして、その変更を元のリポジトリに提供したければ、いわゆる「プルリクエスト」を作ればいいのです。
プルリクエストについては、後ほど説明します。
プルリクエストを作ると、そこにコードレビューのスレッドが立ち上がります。
プロジェクトのオーナーとプルリクエストの作者は、そこで変更についての議論を重ねて、
オーナーが納得した時点で、それをマージすることができます。</p>
</div>
<div class="paragraph">
<p>プロジェクトをフォークするには、プロジェクトのページに行って、ページ右上にある`‘Fork’'ボタンを押します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/forkbutton.png" >}}" alt="``Fork'' ボタン">
</div>
<div class="title">図 88. “Fork” ボタン</div>
</div>
<div class="paragraph">
<p>数秒後、新しいプロジェクトのページに自動的に移動します。これは、あなた自身が書き込み可能なコピーです。</p>
</div>
</div>
<div class="sect3">
<h3 id="r_github_flow">GitHub Flow</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>GitHub は、プルリクエストを中心としたコラボレーションのワークフローを想定して作られています。
ひとつのリポジトリを共有する密接に連携したチームでの作業であっても、世界中に広がる企業や個人が関わるプロジェクトで何十ものフォークがあるプロジェクトであっても、
このワークフローはうまく機能します。
その中心になるのが、<a href="{{< relurl "book/ja/v2/ch00/ch03-git-branching" >}}">[ch03-git-branching]</a> でとりあげた <a href="{{< relurl "book/ja/v2/ch00/r_topic_branch" >}}">トピックブランチ</a> のワークフローです。</p>
</div>
<div class="paragraph">
<p>全体的な流れは、以下のようになります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>master</code> からトピックブランチを作る。</p>
</li>
<li>
<p>そこに、プロジェクトの改良につながるコミットをする。</p>
</li>
<li>
<p>このブランチを、自分の GitHub プロジェクトにプッシュする。</p>
</li>
<li>
<p>GitHub 上でプルリクエストを作る。</p>
</li>
<li>
<p>議論を重ね、必要ならさらにコミットをする。</p>
</li>
<li>
<p>プロジェクトのオーナーは、プルリクエストをマージする（あるいは、マージせずに閉じる）。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>これは基本的に、<a href="{{< relurl "book/ja/v2/ch00/r_integration_manager" >}}">統合マネージャー型のワークフロー</a> でとりあげる、統合マネージャー型のワークフローです。
しかし、変更についてのやりとりやレビューをメールで行う代わりに、ここでは GitHub のウェブベースのツールを使います。</p>
</div>
<div class="paragraph">
<p>GitHub で公開しているオープンソースのプロジェクトに対して、このフローを使って変更を提案する例を見ていきましょう。</p>
</div>
<div class="sect4">
<h4 id="_プルリクエストの作成">プルリクエストの作成</h4>
<div class="paragraph">
<p>自分のArduino上で実行するコードを探していたトニーは、GitHub 上にすばらしいプログラムがあることを発見しました。
それが <a href="https://github.com/schacon/blink" class="bare">https://github.com/schacon/blink</a> です。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/blink-01-start.png" >}}" alt="貢献したいプロジェクト">
</div>
<div class="title">図 89. 貢献したいプロジェクト</div>
</div>
<div class="paragraph">
<p>ただ、ひとつ問題がありました。点滅の間隔が速すぎるのです。1 秒おきに状態を切り替えるのではなく、3 秒くらいは間を置きたいものです。
さて、このプログラムを改良して、その変更を提案してみましょう。</p>
</div>
<div class="paragraph">
<p>まずは、先ほど説明した <em>Fork</em> ボタンをクリックして、このプロジェクトのコピーを手に入れます。
この例で使うユーザー名は “tonychacon” とします。つまり、できあがったコピーは <code>https://github.com/tonychacon/blink</code> となり、ここからはこのプロジェクトを変更していきます。
これをローカルにクローンして、トピックブランチを作り、コードを変更して、その変更を GitHub にプッシュしましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git clone https://github.com/tonychacon/blink <b class="conum">(1)</b>
Cloning into 'blink'...

$ cd blink
$ git checkout -b slow-blink <b class="conum">(2)</b>
Switched to a new branch 'slow-blink'

$ sed -i '' 's/1000/3000/' blink.ino <b class="conum">(3)</b>

$ git diff --word-diff <b class="conum">(4)</b>
diff --git a/blink.ino b/blink.ino
index 15b9911..a6cc5a5 100644
--- a/blink.ino
+++ b/blink.ino
@@ -18,7 +18,7 @@ void setup() {
// the loop routine runs over and over again forever:
void loop() {
  digitalWrite(led, HIGH);   // turn the LED on (HIGH is the voltage level)
  [-delay(1000);-]{+delay(3000);+}               // wait for a second
  digitalWrite(led, LOW);    // turn the LED off by making the voltage LOW
  [-delay(1000);-]{+delay(3000);+}               // wait for a second
}

$ git commit -a -m 'three seconds is better' <b class="conum">(5)</b>
[slow-blink 5ca509d] three seconds is better
 1 file changed, 2 insertions(+), 2 deletions(-)

$ git push origin slow-blink <b class="conum">(6)</b>
Username for 'https://github.com': tonychacon
Password for 'https://tonychacon@github.com':
Counting objects: 5, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 340 bytes | 0 bytes/s, done.
Total 3 (delta 1), reused 0 (delta 0)
To https://github.com/tonychacon/blink
 * [new branch]      slow-blink -&gt; slow-blink</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>フォークしたプロジェクトを、ローカルにクローンする</p>
</li>
<li>
<p>わかりやすい名前のトピックブランチを作る</p>
</li>
<li>
<p>コードを変更する</p>
</li>
<li>
<p>問題はなさそうだ</p>
</li>
<li>
<p>この変更をトピックブランチにコミットする</p>
</li>
<li>
<p>新しいトピックブランチを、GitHub 上のフォークに書き戻す</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>この状態で GitHub 上のフォークに戻ると、GitHub 上に新しいトピックブランチがプッシュされたことを伝えてくれます。
また、大きな緑色のボタンを使えば、変更点を確認したり、元のプロジェクトへのプルリクエストを送ったりできます。</p>
</div>
<div class="paragraph">
<p>あるいは、<code>https://github.com/&lt;user&gt;/&lt;project&gt;/branches</code> にある “Branches” ページから自分のトピックブランチに移動して、そこからプルリクエストを送ることもできます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/blink-02-pr.png" >}}" alt="プルリクエストのボタン">
</div>
<div class="title">図 90. プルリクエストのボタン</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>この緑のボタンをクリックすると、プルリクエストのタイトルと説明を入力する画面に遷移します。
ちゃんと時間をかけて説明を書きましょう。損はしないはずです。プルリクエストを受ける側のプロジェクトオーナーからすれば、説明文がよければあなたの意図が汲み取りやすくなるからです。そうすれば、オーナーはプルリクエストの内容を正確に評価できますし、それを取り込むことがプロジェクトにとってプラスかどうかを判断できるでしょう。</p>
</div>
<div class="paragraph">
<p>この画面では、トピックブランチ内のコミットのうち、`master`よりも先行しているコミットの一覧 (今回の場合はひとつだけ) も確認できます。
また、このブランチをオーナーがマージしたときに適用される変更の、unified形式の差分も表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/blink-03-pull-request-open.png" >}}" alt="プルリクエストの作成">
</div>
<div class="title">図 91. プルリクエストの作成ページ</div>
</div>
<div class="paragraph">
<p>この画面で <em>Create pull request</em> ボタンを押すと、フォーク元のプロジェクトのオーナーに、
誰かが変更を提案しているという通知が届きます。この通知には、変更に関するすべての情報が記載されたページへのリンクが含まれています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注記</div>
</td>
<td class="content">
<div class="paragraph">
<p>一般にプルリクエストは、こういった公開プロジェクトに対する変更を、その準備が整った時点で提案するために作るものです。
しかし、内部的なプロジェクトの開発サイクルにおいて、 <em>開発を始めるタイミングで</em> プルリクエストを作ることもよくあります。
プルリクエストを作った*後でも*、そのトピックブランチへのプッシュを続けることができます。
最後の最後にプルリクエストを行うのではなく、早い時点でプルリクエストを作っておけば、
その後の作業状況をチーム内で共有できます。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h4 id="_プルリクエストの繰り返し">プルリクエストの繰り返し</h4>
<div class="paragraph">
<p>これで、元のプロジェクトのオーナーは、変更の提案を見られるようになりました。それをマージしたり、却下したり、コメントしたりすることができます。
ここでは、オーナーが変更提案を気に入ったものの、ライトが消えている時間を点灯している時間よりも少しだけ長くしたほうがいいと感じたことにしましょう。</p>
</div>
<div class="paragraph">
<p><a href="{{< relurl "book/ja/v2/ch00/ch05-distributed-git" >}}">[ch05-distributed-git]</a> のワークフローなら、この手のやりとりはメールで行うところですが、GitHub の場合はこれをオンラインで行います。
プロジェクトのオーナーはunfied diffをレビューして、コメントを残します。コメントしたい行をクリックすれば、コメントを残せます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/blink-04-pr-comment.png" >}}" alt="PRの行コメント">
</div>
<div class="title">図 92. プルリクエストのコードの特定の行へのコメント</div>
</div>
<div class="paragraph">
<p>メンテナがコメントを入れると、プルリクエストの作者 (そして、そのリポジトリをウォッチしているすべての人たち) に、通知が届きます。
通知をカスタマイズする方法については後述しますが、メールでの通知を受け取るように設定している場合は、以下のようなメールも届きます。</p>
</div>
<div id="r_email_notification" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/blink-04-email.png" >}}" alt="メールでの通知">
</div>
<div class="title">図 93. 通知メールで送られたコメント</div>
</div>
<div class="paragraph">
<p>オーナーだけでなく誰でも、プルリクエスト全体に対するコメントができます。
<a href="{{< relurl "book/ja/v2/ch00/r_pr_discussion" >}}">プルリクエストのディスカッションページ</a> では、プロジェクトのオーナーがコードの特定の行についてコメントしたうえで、さらにプルリクエスト全体に関するコメントも残しています。
また、コードへのコメントが、一連の会話に組み込まれていることにもお気づきでしょう。</p>
</div>
<div id="r_pr_discussion" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/blink-05-general-comment.png" >}}" alt="PRのディスカッションページ">
</div>
<div class="title">図 94. プルリクエストのディスカッションページ</div>
</div>
<div class="paragraph">
<p>プルリクエストの作者は、自分の変更を受け入れてもらうために何が必要なのかがわかりました。
幸運にも、そんなに手間のかかることではありません。
メールでのやりとりの場合は、一連の作業をやり直した上でもう一度メーリングリストに投稿する必要がありますが、
GitHub なら、単にトピックブランチにコミットしてそれをプッシュするだけで済みます。
また、<a href="{{< relurl "book/ja/v2/ch00/r_pr_final" >}}">プルリクエストの最終形</a> にあるように、更新されたプルリクエストでは変更前のコードへのコメント表示が省略されています。追加されたコミットによって変更されたコードへのコメントだからです。</p>
</div>
<div class="paragraph">
<p>なお、既存のプルリクエストにコミットを追加しても、通知は送られません。そこで、修正をプッシュしたトニーは、修正が終わったことをコメントでプロジェクトオーナーに伝えることにしました。</p>
</div>
<div id="r_pr_final" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/blink-06-final.png" >}}" alt="PRの最終形">
</div>
<div class="title">図 95. プルリクエストの最終形</div>
</div>
<div class="paragraph">
<p>このプルリクエストのページで “Files Changed” タブをクリックすると、“unified” 形式の diff を確認できます。
つまり、このトピックブランチをマージしたときにどんな変更が施されるのかを、まとめて確認できるのです。
<code>git diff</code> の用語に直すと、このタブを開いたときに表示される内容は、プルリクエストの対象になっているブランチ上で
<code>git diff master...&lt;branch&gt;</code> を実行した結果になります。
この形式の diff についての詳細は、<a href="{{< relurl "book/ja/v2/ch00/r_what_is_introduced" >}}">何が変わるのかの把握</a> を参照ください。</p>
</div>
<div class="paragraph">
<p>もうひとつお気づきのことがあることでしょう。
GitHub は、このプルリクエストが問題なくマージできることを確認したうえで、サーバー上でマージを実行するためのボタンを表示します。
このボタンが表示されるのは、あなたがこのリポジトリへの書き込みアクセス権限を持っていて、かつ問題なくマージ可能な場合だけです。
このボタンをクリックすると、GitHub は “non-fast-forward” なマージを行います。
つまり、仮に fast-forward 可能なマージであったとしても、明示的にマージコミットを作ります。</p>
</div>
<div class="paragraph">
<p>お望みなら、このブランチを取得した上で、ローカルでマージすることもできます。
このブランチを <code>master</code> にマージしてから GitHub にプッシュすると、このプルリクエストは自動的に閉じられます。</p>
</div>
<div class="paragraph">
<p>これが、大半の GitHub プロジェクトが使っている基本的なワークフローです。
トピックブランチを作り、そこからプルリクエストを作って、議論を重ね、必要に応じてさらに作業を重ねて、最終的にそのリクエストをマージするか、あるいはマージせずに終了します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注記</div>
</td>
<td class="content">
<div class="title">フォークしなくてもかまわない</div>
<div class="paragraph">
<p>同じリポジトリのふたつのブランチ間でのプルリクエストもできるということを知っておきましょう。
誰かと一緒に何らかのフィーチャーの作業をしていて、両方ともそのプロジェクトへの書き込み権限を持っている場合なら、
トピックブランチをそのリポジトリにプッシュした上で、同じプロジェクトの <code>master</code> ブランチへのプルリクエストを作ることができます。
そこで、コードのレビューや議論を進めればいいでしょう。
このときに、わざわざフォークする必要はありません。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h3 id="_プルリクエストの応用テクニック">プルリクエストの応用テクニック</h3>
<div class="paragraph">
<p>GitHub のプロジェクトに貢献する際の基本がわかったところで、
プルリクエストに関するちょっとしたヒントやテクニックを紹介しましょう。これらを使えば、プルリクエストをさらに活用できるでしょう。</p>
</div>
<div class="sect4">
<h4 id="_パッチとしてのプルリクエスト">パッチとしてのプルリクエスト</h4>
<div class="paragraph">
<p>実際のところ、多くのプロジェクトは、プルリクエストを完璧なパッチ群である (つまり、きちんと順序どおりに適用しなければいけない) とは考えていません。
これは、メーリングリストベースで運営するプロジェクトで一般的な考えかたとは異なります。
GitHub のプロジェクトでは、プルリクエストのブランチを変更提案に関する議論の場と捕らえていることが多く、
最終的にできあがった unified diff をマージするのだと考えています。</p>
</div>
<div class="paragraph">
<p>この違いを認識しておくことが大切です。一般に、変更を提案するのは、コードが完璧に仕上がる前の段階です。
一方、メーリングリストベースの運営では、まだできあがってもいないパッチを投稿することなど、まずないでしょう。
未完成の段階で変更を提案することで、メンテナとの議論を早めに始めることができます。
コミュニティの協力で、より適切なソリューションにたどり着けるようになるでしょう。
プルリクエストで提案したコードに対してメンテナやコミュニティから変更の提案があったときに、
パッチをゼロから作り直す必要はありません。
差分だけを、新たなコミットとしてプッシュすればいいのです。
その後の議論は、これまでの経緯を踏まえた上で進みます。</p>
</div>
<div class="paragraph">
<p><a href="{{< relurl "book/ja/v2/ch00/r_pr_final" >}}">プルリクエストの最終形</a> をもう一度見てみましょう。プルリクエストの作者は、自分のコミットをリベースして新たなプルリクエストを作ったわけではありません。
単に、新しいコミットを追加して、それを既存のブランチにプッシュしただけです。
そのおかげで、今後このプルリクエストのページを見直すことがあったときにも、最終的な決定に至るまでの経緯を簡単に確認できるのです。
“Merge” ボタンを押したときに、本来不要な場面でも意図的にマージコミットを作っているのは、
後からそのプルリクエストを参照しやすいようにするためです。
必要に応じて、それまでの流れをすぐに調べることができます。</p>
</div>
</div>
<div class="sect4">
<h4 id="_上流への追従">上流への追従</h4>
<div class="paragraph">
<p>プルリクエストを作った後で元のプロジェクトに変更が加わったなどの理由で、プルリクエストがそのままではマージできなくなることがあります。
そんな場合は、そのプルリクエストを修正して、メンテナがマージしやすいようにしておきたいことでしょう。
GitHub は、そのままでマージできるかどうかをチェックして、すべてのプルリクエストのページの最下部に結果を表示します。</p>
</div>
<div id="r_pr_fail" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/pr-01-fail.png" >}}" alt="マージできないPR">
</div>
<div class="title">図 96. そのままではマージできないプルリクエスト</div>
</div>
<div class="paragraph">
<p><a href="{{< relurl "book/ja/v2/ch00/r_pr_fail" >}}">そのままではマージできないプルリクエスト</a> のようになっていたら、自分のブランチを修正して、この表示がグリーンになるようにしたいところです。
そうすれば、メンテナに余計な手間をかけさせずに済みます。</p>
</div>
<div class="paragraph">
<p>グリーンにするための主な選択肢は、二種類あります。
ひとつは、自分のブランチを、プルリクエストの対象ブランチ (普通は、フォーク元のリポジトリの <code>master</code>) の先端にリベースすること。
もうひとつは、その対象ブランチを自分のブランチにマージすることです。</p>
</div>
<div class="paragraph">
<p>GitHub 上の開発者の多くは、後者を選んでいるようです。その理由は、先述したとおりです。
重要なのは、そこにいたるまでの歴史と、最終的にマージしたという事実だと考えているのでしょう。
リベースをすると、歴史がすっきりするという以外の利点はありません。そして、リベースはマージに比べて <strong>ずっと</strong> 難しいし、間違いを起こしやすいものです。</p>
</div>
<div class="paragraph">
<p>対象ブランチをマージして、自分のプルリクエストをそのまま取り込んでもらえるようにする手順は、次のとおりです。
まず、オリジナルのリポジトリを新しいリモートとして追加して、それをフェッチします。
そして、そのリポジトリのメインブランチを自分のトピックブランチにマージします。
何か問題があれば修正し、その結果をプルリクエストと同じブランチにプッシュします。</p>
</div>
<div class="paragraph">
<p>先ほどの “tonychacon” の例に戻りましょう。プルリクエストを出した後にオリジナルの作者がリポジトリに変更を加えたため、
プルリクエストがそのままでは取り込めなくなってしまいました。そんな場合の手順は、以下のとおりです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git remote add upstream https://github.com/schacon/blink <b class="conum">(1)</b>

$ git fetch upstream <b class="conum">(2)</b>
remote: Counting objects: 3, done.
remote: Compressing objects: 100% (3/3), done.
Unpacking objects: 100% (3/3), done.
remote: Total 3 (delta 0), reused 0 (delta 0)
From https://github.com/schacon/blink
 * [new branch]      master     -&gt; upstream/master

$ git merge upstream/master <b class="conum">(3)</b>
Auto-merging blink.ino
CONFLICT (content): Merge conflict in blink.ino
Automatic merge failed; fix conflicts and then commit the result.

$ vim blink.ino <b class="conum">(4)</b>
$ git add blink.ino
$ git commit
[slow-blink 3c8d735] Merge remote-tracking branch 'upstream/master' \
    into slower-blink

$ git push origin slow-blink <b class="conum">(5)</b>
Counting objects: 6, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (6/6), done.
Writing objects: 100% (6/6), 682 bytes | 0 bytes/s, done.
Total 6 (delta 2), reused 0 (delta 0)
To https://github.com/tonychacon/blink
   ef4725c..3c8d735  slower-blink -&gt; slow-blink</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>オリジナルのリポジトリを “upstream” という名前のリモートとして追加する</p>
</li>
<li>
<p>そのリモートの、最新の状態をフェッチする</p>
</li>
<li>
<p>メインブランチを、自分のトピックブランチにマージする</p>
</li>
<li>
<p>衝突を解決する</p>
</li>
<li>
<p>同じトピックブランチに、再びプッシュする</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>これでプルリクエストが自動的に更新されて、マージ可能かどうかが再びチェックされます。</p>
</div>
<div id="r_pr_merge_fix" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/pr-02-merge-fix.png" >}}" alt="修正後のPR">
</div>
<div class="title">図 97. そのままマージできるようになったプルリクエスト</div>
</div>
<div class="paragraph">
<p>Git のすばらしいところのひとつが、これらの作業を継続的に行えるということです。
長期にわたるプロジェクトでも、対象ブランチからのマージを何度でも繰り返せるので、前回のマージ以降に発生した衝突さえ気をつけていれば、混乱なく作業を続けられます。</p>
</div>
<div class="paragraph">
<p>ブランチをリベースしてすっきりさせたい場合は、そうしてもかまいません。
しかし、既に作成済みのプルリクエストに対して、それを強制的にプッシュするのは避けたほうがいいでしょう。
もし他の人がそれを手元に取得して何かの作業を進めると、<a href="{{< relurl "book/ja/v2/ch00/r_rebase_peril" >}}">ほんとうは怖いリベース</a> で説明したような問題が発生します。
リベースした場合は、それを GitHub 上で新しいブランチにして、新しいプルリクエストを作るようにしましょう。
新しいプルリクエストから元のプルリクエストを参照して、そして元のプルリクエストは閉じてしまいます。</p>
</div>
</div>
<div class="sect4">
<h4 id="_参照">参照</h4>
<div class="paragraph">
<p>…と言われて気になるのは、「元のプルリクエストをどうやって参照すればいいの？」ということでしょう。
GitHub 上で他のものを参照するにはいろんな方法があって、GitHub 上で何かを書ける場所ならほぼどこでも他のものを参照できます。</p>
</div>
<div class="paragraph">
<p>まずは、別のプルリクエストあるいは Issue を相互参照する方法から紹介します。
プルリクエストや Issue には番号が振られていて、この番号はプロジェクト内で一意になっています。
つまり、たとえばプルリクエスト#3とIssue #3が <em>両方とも</em> 存在することはありえないのです。
他のプルリクエストや Issue を参照したい場合は、コメントや説明文の中で単に <code>#&lt;num&gt;</code> と書くだけでかまいません。
あるいは、もう少し細かく、誰か他の人が作った Issue やプルリクエストを指定することもできます。
<code>username#&lt;num&gt;</code> と書けば、今いるリポジトリの別のフォーク上での Issue やプルリクエストを参照できるし、
<code>username/repo#&lt;num&gt;</code> と書けば、別のリポジトリ上のものも参照できます。</p>
</div>
<div class="paragraph">
<p>実例を見てみましょう。
先ほど説明したとおり、リベースをした上で新しいプルリクエストを作ったものとします。新しいプルリクエストから、古いプルリクエストを参照したいところです。
また、そのリポジトリのフォーク上にある Issue や、まったく別のプロジェクトにある Issue も参照するつもりです。
説明文は、<a href="{{< relurl "book/ja/v2/ch00/r_pr_references" >}}">プルリクエスト内での相互参照</a> のようになります。</p>
</div>
<div id="r_pr_references" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/mentions-01-syntax.png" >}}" alt="PRの参照">
</div>
<div class="title">図 98. プルリクエスト内での相互参照</div>
</div>
<div class="paragraph">
<p>このプルリクエストを投稿すると、画面上では <a href="{{< relurl "book/ja/v2/ch00/r_pr_references_render" >}}">プルリクエスト内での相互参照のレンダリング</a> のような表示になります。</p>
</div>
<div id="r_pr_references_render" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/mentions-02-render.png" >}}" alt="PR内での参照のレンダリング">
</div>
<div class="title">図 99. プルリクエスト内での相互参照のレンダリング</div>
</div>
<div class="paragraph">
<p>GitHub の完全な URL を入力したところも、画面上では短縮されて、必要な情報だけが見えていることがわかるでしょう。</p>
</div>
<div class="paragraph">
<p>トニーが元のプルリクエストを閉じると、そのことが新しいプルリクエストのほうにも表示されることがわかります。
GitHub が、プルリクエストのタイムラインに自動的にトラックバックを送ったのです。
これで、古いプルリクエストを見にきたすべての人は、そのリクエストの後継となる新しいプルリクエストにたどり着けるようになるのです。
リンクは、<a href="{{< relurl "book/ja/v2/ch00/r_pr_closed" >}}">プルリクエスト内での相互参照のレンダリング</a> のように表示されます。</p>
</div>
<div id="r_pr_closed" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/mentions-03-closed.png" >}}" alt="閉じられたPR">
</div>
<div class="title">図 100. プルリクエスト内での相互参照のレンダリング</div>
</div>
<div class="paragraph">
<p>issue の番号だけでなく、SHA-1 を示して特定のコミットを参照することもできます。
SHA-1 を指定する際には 40 文字ぶんすべてを示す必要がありますが、コメントの中に SHA-1 を発見すると、GitHub はそれを当該コミットへリンクしてくれます。
他のフォークやその他のリポジトリのコミットを参照する場合の方法は、issue の場合と同じです。</p>
</div>
</div>
</div>
<div class="sect3">
<h3 id="_markdown">Markdown</h3>
<div class="paragraph">
<p>他の Issue へのリンクは、GitHub のテキストボックスでできるさまざまなことのうちの、ほんの始まりに過ぎません。
Issue やプルリクエストの説明、それに対するコメント、コードに対するコメントなどなどでは、いわゆる “GitHub Flavored Markdown” を使うことができます。
Markdown はプレーンテキストと似ていますが、よりリッチなレンダリングを行います。</p>
</div>
<div class="paragraph">
<p>コメントや説明文を、Markdown を使って書いた例を <a href="{{< relurl "book/ja/v2/ch00/r_example_markdown" >}}">Markdown での記述例と、そのレンダリング結果</a> に示します。</p>
</div>
<div id="r_example_markdown" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/markdown-01-example.png" >}}" alt="Markdown の例">
</div>
<div class="title">図 101. Markdown での記述例と、そのレンダリング結果</div>
</div>
<div class="sect4">
<h4 id="_github_flavored_markdown">GitHub Flavored Markdown</h4>
<div class="paragraph">
<p>GitHub Flavored Markdownは、基本的なMarkdownの文法に、GitHub 流の味付けをしたものです。
プルリクエストや Issue を作ったり、それにコメントしたりするときに、役立つことでしょう。</p>
</div>
<div class="sect5">
<h6 id="_タスクリスト">タスクリスト</h6>
<div class="paragraph">
<p>GitHub 流の Markdown で追加された便利な機能の中で、最初に紹介する機能が、タスクリストです。これは、プルリクエストで特に便利です。
タスクリストとは、チェックボックス付きの、やることリストです。
これを Issue やプルリクエストで使うと、完了させるまでに何を済ませなければいけないのかを表せます。</p>
</div>
<div class="paragraph">
<p>タスクリストの作りかたは、以下のとおりです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">- [X] Write the code
- [ ] Write all the tests
- [ ] Document the code</code></pre>
</div>
</div>
<div class="paragraph">
<p>プルリクエストや Issue の説明文にこのように書いておくと、<a href="{{< relurl "book/ja/v2/ch00/r_task_lists" >}}">Markdown でのコメント内に表示されたタスクリスト</a> のような表示になります。</p>
</div>
<div id="r_task_lists" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/markdown-02-tasks.png" >}}" alt="タスクリストの例">
</div>
<div class="title">図 102. Markdown でのコメント内に表示されたタスクリスト</div>
</div>
<div class="paragraph">
<p>これはたとえば、プルリクエストに対して、「これだけのことを済ませればマージの準備が整う」ということを示すために使うことがあります。
この機能のすばらしいところは、単にチェックボックスをクリックするだけで、コメントが更新できるということです。
タスクが完了したときに、わざわざ Markdown を直接編集する必要はありません。</p>
</div>
<div class="paragraph">
<p>さらに、GitHub は、Issue やプルリクエストの中にあるタスクリストを見つけて、そのメタデータを一覧ページにも表示してくれます。
たとえば、あるプルリクエストの中でタスクを作ったときに、プルリクエストの一覧ページを見ると、タスクがどの程度完了しているのかを確認できるのです。
これは、プルリクエストをサブタスクに切り分けたり、他のひとたちがそのブランチの進捗を追いかけたりする際にも役立ちます。
この機能の実例を <a href="{{< relurl "book/ja/v2/ch00/r_task_list_progress" >}}">プルリクエスト一覧における、タスク一覧の概要表示</a> に示します。</p>
</div>
<div id="r_task_list_progress" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/markdown-03-task-summary.png" >}}" alt="タスクリストの例">
</div>
<div class="title">図 103. プルリクエスト一覧における、タスク一覧の概要表示</div>
</div>
<div class="paragraph">
<p>この機能は、
トピックブランチを作ったばかりのときにプルリクエストを出して、その後の実装の進捗をプルリクエスト上で追いかけていくような場合に、とても便利です。</p>
</div>
</div>
<div class="sect5">
<h6 id="_コードスニペット">コードスニペット</h6>
<div class="paragraph">
<p>コメントに、コードスニペットを追加することもできます。
これは、これから <em>やろうとしている</em> ことを、実際に実装する前に表明したりするときに便利です。
また、うまく動かないサンプルコードや、このプルリクエストで実装できることを説明するサンプルコードなどを示すときにも使われます。</p>
</div>
<div class="paragraph">
<p>コードスニペットを追加するには、バッククォートで「囲む」必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">```java
for(int i=0 ; i &lt; 5 ; i++)
{
   System.out.println("i is : " + i);
}
```</code></pre>
</div>
</div>
<div class="paragraph">
<p>このサンプルでの <em>java</em> のように言語名を追加すると、GitHub はスニペットのシンタックスハイライトを行います。
このサンプルは、最終的に <a href="{{< relurl "book/ja/v2/ch00/r_md_code" >}}">サンプルコードをレンダリングした結果</a> のような表示になります。</p>
</div>
<div id="r_md_code" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/markdown-04-fenced-code.png" >}}" alt="レンダリングされたコード">
</div>
<div class="title">図 104. サンプルコードをレンダリングした結果</div>
</div>
</div>
<div class="sect5">
<h6 id="_引用">引用</h6>
<div class="paragraph">
<p>長いコメントの一部に返信するときは、その部分を引用することができます。引用するには、各行の先頭に <code>&gt;</code> を付け加えます。
これはとても便利で、よく使われるものなので、キーボードショートカットも用意されています。
コメントの中で返信したい部分を選択して <code>r</code> キーを押すと、選択した部分を引用した、新しいコメント入力欄が現れます。</p>
</div>
<div class="paragraph">
<p>引用は、このような感じになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">&gt; Whether 'tis Nobler in the mind to suffer
&gt; The Slings and Arrows of outrageous Fortune,

How big are these slings and in particular, these arrows?</code></pre>
</div>
</div>
<div class="paragraph">
<p>このコメントが、画面上では <a href="{{< relurl "book/ja/v2/ch00/r_md_quote" >}}">引用のレンダリングの例</a> のようにレンダリングされます。</p>
</div>
<div id="r_md_quote" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/markdown-05-quote.png" >}}" alt="引用のレンダリング">
</div>
<div class="title">図 105. 引用のレンダリングの例</div>
</div>
</div>
<div class="sect5">
<h6 id="_絵文字">絵文字</h6>
<div class="paragraph">
<p>最後に紹介するのが絵文字です。コメントの中で、絵文字を使えます。
実際に、GitHub の Issue やプルリクエストの多くで、絵文字が使われています。
GitHub には、絵文字の入力支援機能もあるのです。
コメントの記入中に <code>:</code> を入力すると、オートコンプリート機能が立ち上がって、絵文字を探すのを手伝ってくれます。</p>
</div>
<div id="r_md_emoji_auto" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/markdown-06-emoji-complete.png" >}}" alt="絵文字のオートコンプリート">
</div>
<div class="title">図 106. 絵文字のオートコンプリートの例</div>
</div>
<div class="paragraph">
<p>絵文字は <code>:&lt;name&gt;:</code> 形式で表し、コメント内のどこでも使えます。
たとえば、このように書いたとしましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">I :eyes: that :bug: and I :cold_sweat:.

:trophy: for :microscope: it.

:+1: and :sparkles: on this :ship:, it's :fire::poop:!

:clap::tada::panda_face:</code></pre>
</div>
</div>
<div class="paragraph">
<p>これをレンダリングした結果は、<a href="{{< relurl "book/ja/v2/ch00/r_md_emoji" >}}">絵文字だらけのコメント</a> のようになります。</p>
</div>
<div id="r_md_emoji" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/markdown-07-emoji.png" >}}" alt="絵文字">
</div>
<div class="title">図 107. 絵文字だらけのコメント</div>
</div>
<div class="paragraph">
<p>めちゃめちゃ便利というほどのものではありませんが、
楽しさや熱意を伝える手段としては他の追随を許さないものでしょう。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注記</div>
</td>
<td class="content">
<div class="paragraph">
<p>最近は、絵文字を使えるウェブサービスも多くなってきました。
自分の言いたいことをうまく伝えられる絵文字を見つけるための、チートシートも公開されています。</p>
</div>
<div class="paragraph">
<p><a href="http://www.emoji-cheat-sheet.com" class="bare">http://www.emoji-cheat-sheet.com</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_画像">画像</h6>
<div class="paragraph">
<p>厳密に言うと GitHub Flavored Markdown とは関係ありませんが、これはとても便利な機能です。
Markdown でのコメントに画像のリンクを追加するのは、画像を探したり URL を埋め込んだりと面倒くさいものです。
しかし GitHub では、テキストエリアに画像をドラッグ＆ドロップするだけで、それを埋め込めるのです。</p>
</div>
<div id="r_md_drag" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/markdown-08-drag-drop.png" >}}" alt="画像のドラッグ＆ドロップ">
</div>
<div class="title">図 108. ドラッグ＆ドロップで画像をアップロードして、自動的に埋め込む</div>
</div>
<div class="paragraph">
<p><a href="{{< relurl "book/ja/v2/ch00/r_pr_references" >}}">プルリクエスト内での相互参照</a> に戻ると、テキストエリアの上に小さく “Parsed as Markdown” とヒントが書かれていることがわかります。
これをクリックすると、GitHub 上での Markdown でできるすべてのことをまとめた、チートシートを見ることができます。</p>
</div>
</div>
</div>
</div>
<div id="nav"><a href="{{< previous-section >}}">prev</a> | <a href="{{< next-section >}}">next</a></div>