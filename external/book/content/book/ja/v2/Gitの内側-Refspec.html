---
### DO NOT EDIT! Generated by script/update-book2.rb
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: ja
  chapter:
    title: Gitの内側
    number: 10
  section:
    title: Refspec
    number: 5
    cs_number: '10.5'
    previous: book/ja/v2/Gitの内側-Packfile
    next: book/ja/v2/Gitの内側-転送プロトコル
title: Git - Refspec
url: "/book/ja/v2/Gitの内側-Refspec.html"
---
<h2 id="r_refspec">Refspec</h2>
<div class="paragraph">
<p>本書の全体に渡って、リモートブランチからローカルの参照へのシンプルなマッピングを使用してきましたが、もっと複雑な場合もあります。以下のようにリモートを追加したとしましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git remote add origin https://github.com/schacon/simplegit-progit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>.git/config</code> ファイルにセクションを追加して、リモートの名前（<code>origin</code>）、リモートリポジトリのURL、そしてフェッチする対象のrefspecを指定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[remote "origin"]
	url = https://github.com/schacon/simplegit-progit
	fetch = +refs/heads/*:refs/remotes/origin/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>refspecの書式は <code>&lt;src&gt;:&lt;dst&gt;</code> で、その前にオプションとして <code>+</code> を指定できます。ここで <code>&lt;src&gt;</code> はリモート側の参照に対するパターンで、 <code>&lt;dst&gt;</code> はそれらの参照がローカルで書きこまれる場所を示します。
<code>+</code> は、fast-forwardでない場合でも参照を更新するようGitに指示しています。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、 <code>git remote add</code> コマンドを実行すると、自動的にこの設定が書き込まれ、Gitはサーバー上の <code>refs/heads/</code> 以下にあるすべての参照をフェッチして、ローカルの <code>refs/remotes/origin/</code> に書き込みます。
そのため、サーバー上に <code>master</code> ブランチがあるとすると、ローカルでは、そのブランチのログには以下のコマンドでアクセスできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git log origin/master
$ git log remotes/origin/master
$ git log refs/remotes/origin/master</code></pre>
</div>
</div>
<div class="paragraph">
<p>これらはすべて同じ意味を持ちます。なぜなら、どれもGitにより <code>refs/remotes/origin/master</code> に展開されるからです。</p>
</div>
<div class="paragraph">
<p>逆に、常にリモートサーバー上の <code>master</code> ブランチのみをプルして、それ以外のブランチはどれもプルしたくない場合は、fetchの行を以下のように変更します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>fetch = +refs/heads/master:refs/remotes/origin/master</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは、このリモートに対する <code>git fetch</code> のデフォルトのrefspecそのものです。
もし、設定内容とは違う内容を一度だけプルしたければ、コマンドライン上でもrefspecを指定できます。
リモートの <code>master</code> ブランチを、ローカルの <code>origin/mymaster</code> にプルするには、以下のように実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git fetch origin master:refs/remotes/origin/mymaster</code></pre>
</div>
</div>
<div class="paragraph">
<p>複数のrefspecを指定することも可能です。
コマンドライン上で、以下のように複数のブランチをプルできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git fetch origin master:refs/remotes/origin/mymaster \
	 topic:refs/remotes/origin/topic
From git@github.com:schacon/simplegit
 ! [rejected]        master     -&gt; origin/mymaster  (non fast forward)
 * [new branch]      topic      -&gt; origin/topic</code></pre>
</div>
</div>
<div class="paragraph">
<p>このケースでは、 <code>master</code> ブランチのプルはfast-forwardの参照ではなかったため拒否されました。
refspecの先頭に <code>+</code> を指定すると、この動作を上書きできます。</p>
</div>
<div class="paragraph">
<p>さらに、設定ファイルに、フェッチ用のrefspecを複数指定することもできます。
もし、常に <code>master</code> ブランチと <code>experiment</code> ブランチをフェッチしたいならば、以下のように2行追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[remote "origin"]
	url = https://github.com/schacon/simplegit-progit
	fetch = +refs/heads/master:refs/remotes/origin/master
	fetch = +refs/heads/experiment:refs/remotes/origin/experiment</code></pre>
</div>
</div>
<div class="paragraph">
<p>パターン中で、ファイル名の一部だけをワイルドカード指定したグロブを使うことはできません。以下の指定は無効となります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">fetch = +refs/heads/qa*:refs/remotes/origin/qa*</code></pre>
</div>
</div>
<div class="paragraph">
<p>しかし、名前空間（やディレクトリ）を使って、似たようなことは行えます。
一連のブランチをプッシュしてくれるQAチームがいたとして、masterブランチとQAチームのブランチのみを取得したいならば、該当セクションを以下のように使用すればよいでしょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[remote "origin"]
	url = https://github.com/schacon/simplegit-progit
	fetch = +refs/heads/master:refs/remotes/origin/master
	fetch = +refs/heads/qa/*:refs/remotes/origin/qa/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>仮に、QAチームがブランチをプッシュし、開発者チームもブランチをプッシュし、さらに統合チームもブランチをプッシュしたりリモートブランチを使って共同で作業をしたりするような複雑なワークフローに従っているとしましょう。そういった場合でも、上述のように設定しておけば簡単に名前空間を分けることができます。</p>
</div>
<div class="sect3">
<h3 id="r_pushing_refspecs">refspecへのプッシュ</h3>
<div class="paragraph">
<p>このように、名前空間を分けた参照をフェッチできるのは素晴らしいことです。しかし、そもそもQAチームは、どうすれば自分たちのブランチを <code>qa/</code> という名前空間に格納できるのでしょうか?
プッシュの際にrefspecを使えばそれが可能です。</p>
</div>
<div class="paragraph">
<p>QAチームが自分たちの <code>master</code> ブランチをリモートサーバー上の <code>qa/master</code> にプッシュしたい場合、以下のように実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git push origin master:refs/heads/qa/master</code></pre>
</div>
</div>
<div class="paragraph">
<p>QAチームが <code>git push origin</code> を実行する度に、Gitに自動的にこの処理を行ってほしいなら、設定ファイルに <code>push</code> の値を追加することもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[remote "origin"]
	url = https://github.com/schacon/simplegit-progit
	fetch = +refs/heads/*:refs/remotes/origin/*
	push = refs/heads/master:refs/heads/qa/master</code></pre>
</div>
</div>
<div class="paragraph">
<p>このように設定しておくと、 <code>git push origin</code> を実行したときに、デフォルトでローカルの <code>master</code> ブランチをリモートの <code>qa/master</code> ブランチにプッシュするようになります。</p>
</div>
</div>
<div class="sect3">
<h3 id="_参照の削除">参照の削除</h3>
<div class="paragraph">
<p>また、refspecを使ってリモートサーバーから参照を削除することもできます。削除するには以下のコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git push origin :topic</code></pre>
</div>
</div>
<div class="paragraph">
<p>refspecは <code>&lt;src&gt;:&lt;dst&gt;</code> という書式なので、 <code>&lt;src&gt;</code> の部分を取り除くと、要するにリモート上の <code>topic</code> ブランチを空にせよという指示になり、リモート上の参照が削除されます。</p>
</div>
</div>
<div id="nav"><a href="{{< previous-section >}}">prev</a> | <a href="{{< next-section >}}">next</a></div>