---
### DO NOT EDIT! Generated by script/update-book2.rb
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: ja
  chapter:
    title: Git のブランチ機能
    number: 3
  section:
    title: ブランチとは
    number: 1
    cs_number: '3.1'
    previous: book/ja/v2/Git-の基本-まとめ
    next: book/ja/v2/Git-のブランチ機能-ブランチとマージの基本
title: Git - ブランチとは
url: "/book/ja/v2/Git-のブランチ機能-ブランチとは.html"
---
<p></p><p>ほぼすべてと言っていいほどの VCS が、何らかの形式でブランチ機能に対応しています。
ブランチとは、開発の本流から分岐し、本流の開発を邪魔することなく作業を続ける機能のことです。
多くの VCS ツールでは、これは多少コストのかかる処理になっています。
ソースコードディレクトリを新たに作る必要があるなど、巨大なプロジェクトでは非常に時間がかかってしまうことがよくあります。</p><p>Git のブランチモデルは、Git の機能の中でもっともすばらしいものだという人もいるほどです。
そしてこの機能こそが Git を他の VCS とは一線を画すものとしています。
何がそんなにすばらしいのでしょう?
Git のブランチ機能は圧倒的に軽量です。ブランチの作成はほぼ一瞬で完了しますし、ブランチの切り替えも高速に行えます。
その他大勢の VCS とは異なり、Git では頻繁にブランチ作成とマージを繰り返すワークフローを推奨しています。
一日に複数のブランチを切ることさえ珍しくありません。
この機能を理解して身につけることで、あなたはパワフルで他に類を見ないツールを手に入れることになります。
これは、あなたの開発手法を文字通り一変させてくれるでしょう。</p>
<h2 id="r_git_branches_overview">ブランチとは</h2>
<div class="paragraph">
<p>Git のブランチの仕組みについてきちんと理解するには、少し後戻りして Git がデータを格納する方法を知っておく必要があります。</p>
</div>
<div class="paragraph">
<p><a href="{{< relurl "book/ja/v2/ch00/ch01-introduction" >}}">[ch01-introduction]</a> で説明したように、Git はチェンジセットや差分としてデータを保持しているのではありません。そうではなく、スナップショットとして保持しています。</p>
</div>
<div class="paragraph">
<p>Git にコミットすると、Git はコミットオブジェクトを作成して格納します。このオブジェクトには、あなたがステージしたスナップショットへのポインタや作者・メッセージのメタデータ、そしてそのコミットの直接の親となるコミットへのポインタが含まれています。最初のコミットの場合は親はいません。通常のコミットの場合は親がひとつ存在します。複数のブランチからマージした場合は、親も複数となります。</p>
</div>
<div class="paragraph">
<p>これを視覚化して考えるために、ここに 3 つのファイルを含むディレクトリがあると仮定しましょう。3 つのファイルをすべてステージしてコミットしたところです。ステージしたファイルについてチェックサム (<a href="{{< relurl "book/ja/v2/ch00/ch01-introduction" >}}">[ch01-introduction]</a> で説明した SHA-1 ハッシュ) を計算し、そのバージョンのファイルを Git ディレクトリに格納し (Git はファイルを blob として扱います)、そしてそのチェックサムをステージングエリアに追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git add README test.rb LICENSE
$ git commit -m 'The initial commit of my project'</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>git commit</code> を実行してコミットを作るときに、Git は各サブディレクトリ (今回の場合はルートディレクトリひとつだけ) のチェックサムを計算して、そのツリーオブジェクトを Git リポジトリに格納します。
それから、コミットオブジェクトを作ります。このオブジェクトは、コミットのメタデータとルートツリーへのポインタを保持しており、必要に応じてスナップショットを再作成できるようになります。</p>
</div>
<div class="paragraph">
<p>この時点で、Git リポジトリには 5 つのオブジェクトが含まれています。3 つのファイルそれぞれの中身をあらわす blob オブジェクト、ディレクトリの中身の一覧とどのファイルがどの blob に対応するかをあらわすツリーオブジェクト、そしてそのルートツリーおよびすべてのメタデータへのポインタを含むコミットオブジェクトです。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/commit-and-tree.png" >}}" alt="コミットおよびそのツリー">
</div>
<div class="title">図 9. コミットおよびそのツリー</div>
</div>
<div class="paragraph">
<p>なんらかの変更を終えて再びコミットすると、次のコミットには直近のコミットへのポインタが格納されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/commits-and-parents.png" >}}" alt="コミットおよびその親">
</div>
<div class="title">図 10. コミットおよびその親</div>
</div>
<div class="paragraph">
<p>Git におけるブランチとは、単にこれら三つのコミットを指す軽量なポインタに過ぎません。Git のデフォルトのブランチ名は <code>master</code> です。最初にコミットした時点で、直近のコミットを指す <code>master</code> ブランチが作られます。その後コミットを繰り返すたびに、このポインタは自動的に進んでいきます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注記</div>
</td>
<td class="content">
<div class="paragraph">
<p>Git の “master” ブランチは、特別なブランチというわけではありません。
その他のブランチと、何ら変わるところのないものです。
ほぼすべてのリポジトリが “master” ブランチを持っているたったひとつの理由は、
<code>git init</code> コマンドがデフォルトで作るブランチが “master” である (そして、ほとんどの人はわざわざそれを変更しようとは思わない) というだけのことです。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/branch-and-history.png" >}}" alt="ブランチおよびそのコミットの歴史">
</div>
<div class="title">図 11. ブランチおよびそのコミットの歴史</div>
</div>
<div class="sect3">
<h3 id="r_create_new_branch">新しいブランチの作成</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>新しいブランチを作成したら、いったいどうなるのでしょうか?
単に新たな移動先を指す新しいポインタが作られるだけです。
では、新しい testing ブランチを作ってみましょう。
次の <code>git branch</code> コマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git branch testing</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、新しいポインタが作られます。
現時点ではふたつのポインタは同じ位置を指しています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/two-branches.png" >}}" alt="ふたつのブランチが同じ一連のコミットを指す">
</div>
<div class="title">図 12. ふたつのブランチが同じ一連のコミットを指す</div>
</div>
<div class="paragraph">
<p>Git は、あなたが今どのブランチで作業しているのかをどうやって知るのでしょうか?
それを保持する特別なポインタが <code>HEAD</code> と呼ばれるものです。
これは、Subversion や CVS といった他の VCS における <code>HEAD</code> の概念とはかなり違うものであることに注意しましょう。
Git では、HEAD はあなたが作業しているローカルブランチへのポインタとなります。
今回の場合は、あなたはまだ master ブランチにいます。
<code>git branch</code> コマンドは新たにブランチを作成するだけであり、
そのブランチに切り替えるわけではありません。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/head-to-master.png" >}}" alt="ブランチを指す HEAD">
</div>
<div class="title">図 13. ブランチを指す HEAD</div>
</div>
<div class="paragraph">
<p>この状況を確認するのは簡単です。
単に <code>git log</code> コマンドを実行するだけで、ブランチポインタがどこを指しているかを教えてくれます。
このときに指定するオプションは、<code>--decorate</code> です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git log --oneline --decorate
f30ab (HEAD -&gt; master, testing) add feature #32 - ability to add new formats to the central interface
34ac2 Fixed bug #1328 - stack overflow under certain conditions
98ca9 The initial commit of my project</code></pre>
</div>
</div>
<div class="paragraph">
<p>“master” と “testing” の両ブランチが、コミット <code>f30ab</code> の横に表示されていることがわかります。</p>
</div>
</div>
<div class="sect3">
<h3 id="r_switching_branches">ブランチの切り替え</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>ブランチを切り替えるには <code>git checkout</code> コマンドを実行します。
それでは、新しい <code>testing</code> ブランチに移動してみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git checkout testing</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、<code>HEAD</code> は <code>testing</code> ブランチを指すようになります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/head-to-testing.png" >}}" alt="HEAD は現在のブランチを指す">
</div>
<div class="title">図 14. HEAD は現在のブランチを指す</div>
</div>
<div class="paragraph">
<p>それがどうしたって?
では、ここで別のコミットをしてみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ vim test.rb
$ git commit -a -m 'made a change'</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/advance-testing.png" >}}" alt="HEAD が指すブランチが、コミットによって移動する">
</div>
<div class="title">図 15. HEAD が指すブランチが、コミットによって移動する</div>
</div>
<div class="paragraph">
<p>興味深いことに、<code>testing</code> ブランチはひとつ進みましたが <code>master</code> ブランチは変わっていません。
<code>git checkout</code> でブランチを切り替えたときの状態のままです。それでは <code>master</code> ブランチに戻ってみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git checkout master</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/checkout-master.png" >}}" alt="チェックアウトによって HEAD が移動する">
</div>
<div class="title">図 16. チェックアウトによって HEAD が移動する</div>
</div>
<div class="paragraph">
<p>このコマンドは二つの作業をしています。
まず HEAD ポインタが指す先を <code>master</code> ブランチに戻し、そして作業ディレクトリ内のファイルを <code>master</code> が指すスナップショットの状態に戻します。
つまり、この時点以降に行った変更は、これまでのプロジェクトから分岐した状態になるということです。
これは、<code>testing</code> ブランチで一時的に行った作業を巻き戻したことになります。
ここから改めて別の方向に進めるということになります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注記</div>
</td>
<td class="content">
<div class="title">ブランチを切り替えると、作業ディレクトリのファイルが変更される</div>
<div class="paragraph">
<p>気をつけておくべき重要なこととして、Git でブランチを切り替えると、作業ディレクトリのファイルが変更されることを知っておきましょう。
古いブランチに切り替えると、作業ディレクトリ内のファイルは、最後にそのブランチ上でコミットした時点の状態まで戻ってしまいます。
Git がこの処理をうまくできない場合は、ブランチの切り替えができません。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>それでは、ふたたび変更を加えてコミットしてみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ vim test.rb
$ git commit -a -m 'made other changes'</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、プロジェクトの歴史が二つに分かれました (<a href="{{< relurl "book/ja/v2/ch00/rdivergent_history" >}}">分裂した歴史</a> を参照ください)。
新たなブランチを作成してそちらに切り替え、何らかの作業を行い、メインブランチに戻って別の作業をした状態です。
どちらの変更も、ブランチごとに分離しています。ブランチを切り替えつつそれぞれの作業を進め、必要に応じてマージすることができます。
これらをすべて、シンプルに <code>branch</code> コマンドと <code>checkout</code> コマンドそして <code>commit</code> コマンドで行えるのです。</p>
</div>
<div id="rdivergent_history" class="imageblock">
<div class="content">
<img src="{{< relurl "book/ja/v2/images/advance-master.png" >}}" alt="分裂した歴史">
</div>
<div class="title">図 17. 分裂した歴史</div>
</div>
<div class="paragraph">
<p>この状況を <code>git log</code> コマンドで確認することもできます。
<code>git log --oneline --decorate --graph --all</code> を実行すると、コミットの歴史を表示するだけではなく、
ブランチポインタがどのコミットを指しているのかや、歴史がどこで分裂したのかも表示します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git log --oneline --decorate --graph --all
* c2b9e (HEAD, master) made other changes
| * 87ab2 (testing) made a change
|/
* f30ab add feature #32 - ability to add new formats to the
* 34ac2 fixed bug #1328 - stack overflow under certain conditions
* 98ca9 initial commit of my project</code></pre>
</div>
</div>
<div class="paragraph">
<p>Git におけるブランチとは、実際のところ特定のコミットを指す 40 文字の SHA-1 チェックサムだけを記録したシンプルなファイルです。
したがって、ブランチを作成したり破棄したりするのは非常にコストの低い作業となります。
新たなブランチの作成は、単に 41 バイト (40 文字と改行文字) のデータをファイルに書き込むのと同じくらい高速に行えます。</p>
</div>
<div class="paragraph">
<p>これが他の大半の VCS ツールのブランチと対照的なところです。
他のツールでは、プロジェクトのすべてのファイルを新たなディレクトリにコピーしたりすることになります。
プロジェクトの規模にもよりますが、これには数秒から数分の時間がかかることでしょう。
Git ならこの処理はほぼ瞬時に行えます。
また、コミットの時点で親オブジェクトを記録しているので、マージの際にもどこを基準にすればよいのかを自動的に判断してくれます。
そのためマージを行うのも非常に簡単です。
これらの機能のおかげで、開発者が気軽にブランチを作成して使えるようになっています。</p>
</div>
<div class="paragraph">
<p>では、なぜブランチを切るべきなのかについて見ていきましょう。</p>
</div>
</div>
<div id="nav"><a href="{{< previous-section >}}">prev</a> | <a href="{{< next-section >}}">next</a></div>