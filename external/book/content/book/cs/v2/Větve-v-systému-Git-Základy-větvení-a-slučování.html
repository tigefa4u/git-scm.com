---
### DO NOT EDIT! Generated by script/update-book2.rb
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: cs
  chapter:
    title: Větve v systému Git
    number: 3
  section:
    title: Základy větvení a slučování
    number: 2
    cs_number: '3.2'
    previous: book/cs/v2/Větve-v-systému-Git-Větve-v-kostce
    next: book/cs/v2/Větve-v-systému-Git-Správa-větví
title: Git - Základy větvení a slučování
url: "/book/cs/v2/Větve-v-systému-Git-Základy-větvení-a-slučování.html"
---
<h2 id="_základy_větvení_a_slučování">Základy větvení a slučování</h2>
<div class="paragraph">
<p>Proberme si jednoduchý příklad větvení a slučování s pracovním postupem, který můžete využít i v reálném životě.
Postupujete podle těchto kroků:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pracujete na webových stránkách.</p>
</li>
<li>
<p>Vytvoříte větev pro nový případ, na kterém pracujete.</p>
</li>
<li>
<p>V této větvi něco uděláte.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>V tomto okamžiku vám zavolají, že se vyskytla jiná kritická chyba, která vyžaduje rychlou opravu (hotfix).
Provedete následující:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Přepnete se na produkční větev.</p>
</li>
<li>
<p>Vytvoříte větev pro přidání opravy.</p>
</li>
<li>
<p>Po otestování začleníte větev s opravou a odešlete ji do produkce.</p>
</li>
<li>
<p>Přepnete zpět na svůj původní případ a pokračujete v práci.</p>
</li>
</ol>
</div>
<div class="sect3">
<h3 id="_basic_branching">Základní větvení</h3>
<div class="paragraph">
<p>
Řekněme, že pracujete na projektu a už jste vytvořili několik revizí.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/cs/v2/images/basic-branching-1.png" >}}" alt="Jednoduchá historie revizí.">
</div>
<div class="title">Figure 18. Jednoduchá historie revizí</div>
</div>
<div class="paragraph">
<p>Rozhodli jste se, že budete pracovat na problému #53 (issue), zachyceném v jakémkoliv systému pro sledování chyb, který vaše společnost používá.
Abyste vytvořili novou větev a rovnou na ni přepnuli, můžete spustit příkaz <code>git checkout</code> s přepínačem <code>-b</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git checkout -b iss53
Switched to a new branch "iss53"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Jde o zkratku pro příkazy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git branch iss53
$ git checkout iss53</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/cs/v2/images/basic-branching-2.png" >}}" alt="Vytvoření nového ukazatele větve.">
</div>
<div class="title">Figure 19. Vytvoření nového ukazatele větve</div>
</div>
<div class="paragraph">
<p>Pracujete na webových stránkách a zapíšete několik revizí.
S každou novou revizí se větev <code>iss53</code> posune vpřed, protože jste na ni přepnutí (provedli jste <code>checkout</code> a <code>HEAD</code> na ni ukazuje):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ vim index.html
$ git commit -a -m 'added a new footer [issue 53]'</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/cs/v2/images/basic-branching-3.png" >}}" alt="Větev iss53 se při práci posunula vpřed.">
</div>
<div class="title">Figure 20. Větev iss53 se při práci posunula vpřed</div>
</div>
<div class="paragraph">
<p>V tomto okamžiku vám zavolají, že se na webových stránkách vyskytl problém, který musíte okamžitě vyřešit.
Při používání Gitu nemusíte nasadit opravu společně se změnami, které jste provedli při řešení problému <code>iss53</code>. Před opravou produkční verze nemusíte ani vynakládat velké úsilí a změny zase rušit.
Vše, co musíte udělat, je přepnout se zpět na větev <code>master</code>.</p>
</div>
<div class="paragraph">
<p>Ale než tak učiníte, všimněte si, že pokud máte v pracovním adresáři nebo v oblasti připravených změn nezapsané změny, které kolidují s větví, do které se přepínáte, Git vám přepnutí větví nedovolí.
Nejlepší je, když máte při přepínání větví čistý pracovní stav.
Existují způsoby, jak to obejít (konkrétně odložení (stashing) a úprava revize (commit amending)), těm se však budeme věnovat až později, v části <a href="{{< relurl "book/cs/v2/ch00/_git_stashing" >}}">Stashing and Cleaning</a>.
Teď předpokládejme, že jste všechny změny zapsali, takže se můžete přepnout zpět do větve <code>master</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git checkout master
Switched to branch 'master'</code></pre>
</div>
</div>
<div class="paragraph">
<p>V tomto okamžiku vypadá váš pracovní adresář přesně tak, jak vypadal, než jste začali pracovat na problému #53, a vy se nyní můžete soustředit na požadovanou opravu.
Zapamatujte si následující důležitý bod: když přepínáte větve, Git nastavuje obsah pracovního adresáře tak, aby vypadal stejně jako v době, kdy jste v dané větvi prováděli poslední zápis.
Automaticky přidá, odstraní a upraví soubory tak, aby zajistil, že vaše pracovní kopie bude vypadat stejně, jako poslední revize v dané větvi.</p>
</div>
<div class="paragraph">
<p>V dalším kroku máte provést opravu.
Vytvořme si pro ni větev, na níž budeme pracovat, dokud nebude oprava hotová:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git checkout -b hotfix
Switched to a new branch 'hotfix'
$ vim index.html
$ git commit -a -m 'fixed the broken email address'
[hotfix 1fb7853] fixed the broken email address
 1 file changed, 2 insertions(+)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/cs/v2/images/basic-branching-4.png" >}}" alt="Větev pro opravu je odvozená od `master`.">
</div>
<div class="title">Figure 21. Větev pro opravu je odvozená od <code>master</code>
</div>
</div>
<div class="paragraph">
<p>Můžete spustit testy, abyste se ujistili, že oprava splňuje všechny požadavky, a pak můžete větev začlenit (merge) zpět do větve <code>master</code>, aby mohla být nasazena k používání.
Učiníte tak příkazem <code>git merge</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git checkout master
$ git merge hotfix
Updating f42c576..3a0874c
Fast-forward
 index.html | 2 ++
 1 file changed, 2 insertions(+)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ve výstupu příkazu <code>merge</code> si všimněte fráze „fast-forward“.
Protože byl objekt revize <code>C4</code>, na který odkazovala začleňovaná větev <code>hotfix</code>, přímým následníkem objektu <code>C2</code>, na kterém jste, Git jednoduše přesune ukazatel vpřed.
Jinými slovy, pokud se snažíte sloučit jeden objekt revize s jiným, na který se můžete dostat přes historii prvního objektu revize, Git to vše zjednoduší tím, že přesune ukazatel vpřed, protože neexistuje žádná odchylující se práce, s kterou bychom to museli slučovat. Tomuto postupu se říká „rychle vpřed“ („fast-forward“).</p>
</div>
<div class="paragraph">
<p>Vaše změna je nyní obsažena ve snímku revize, na kterou ukazuje větev <code>master</code>, a vy můžete zveřejnit opravu.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/cs/v2/images/basic-branching-5.png" >}}" alt="Větev `master` se přesunula „rychle vpřed“ na `hotfix`.">
</div>
<div class="title">Figure 22. Větev <code>master</code> se přesunula „rychle vpřed“ na <code>hotfix</code>
</div>
</div>
<div class="paragraph">
<p>Po zveřejnění veledůležité opravy se můžete přepnout zpět na práci, které jste se věnovali před jejím přerušením.
Nejprve však smažete větev <code>hotfix</code>, protože už ji nebudete potřebovat — větev <code>master</code> ukazuje na totéž místo.
Větev smažete přidáním volby <code>-d</code> k příkazu <code>git branch</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git branch -d hotfix
Deleted branch hotfix (3a0874c).</code></pre>
</div>
</div>
<div class="paragraph">
<p>Teď se můžete přepnout zpět na větev s rozdělanou prací a pokračovat na problému #53.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git checkout iss53
Switched to branch "iss53"
$ vim index.html
$ git commit -a -m 'finished the new footer [issue 53]'
[iss53 ad82d7a] finished the new footer [issue 53]
1 file changed, 1 insertion(+)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/cs/v2/images/basic-branching-6.png" >}}" alt="Pokračuje práce na větvi `iss53`.">
</div>
<div class="title">Figure 23. Pokračuje práce na větvi <code>iss53</code>
</div>
</div>
<div class="paragraph">
<p>Za zmínku stojí, že práce, kterou jste udělali ve větvi <code>hotfix</code>, není obsažena v souborech ve větvi <code>iss53</code>.
Pokud potřebujete tyto změny do větve vtáhnout, můžete začlenit větev <code>master</code> do větve <code>iss53</code> provedením příkazu <code>git merge master</code>, nebo můžete s integrací změn vyčkat a provést ji až ve chvíli, kdy budete chtít větev <code>iss53</code> vtáhnout zpět do větve <code>master</code>.</p>
</div>
</div>
<div class="sect3">
<h3 id="_basic_merging">Základní slučování</h3>
<div class="paragraph">
<p>
Předpokládejme, že jste se rozhodli, že práce na problému #53 je hotová a lze ji začlenit do větve <code>master</code>.
Abychom tak učinili, začleníme větev <code>iss53</code> do větve <code>master</code> podobně, jako jsme to učinili dříve s větví <code>hotfix</code>.
Jediné, co pro to musíte udělat, je přepnout na větev, do které chcete tuto větev začlenit, a potom spustit příkaz <code>git merge</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git checkout master
Switched to branch 'master'
$ git merge iss53
Merge made by the 'recursive' strategy.
index.html |    1 +
1 file changed, 1 insertion(+)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tady už se to od dřívějšího slučování s větví <code>hotfix</code> trochu liší.
V tomto případě se historie vývoje od určitého bodu v minulosti rozbíhala.
Protože objekt revize, na kterém se ve větvi nacházíte, není přímým předkem větve, kterou připojujete, musí s tím Git něco udělat.
Git v tomto případě provádí jednoduché třícestné sloučení, při kterém používá dva snímky, na které ukazují vrcholy větví, a jejich společného předka.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/cs/v2/images/basic-merging-1.png" >}}" alt="Při typickém slučování se používají tři snímky.">
</div>
<div class="title">Figure 24. Při typickém slučování se používají tři snímky</div>
</div>
<div class="paragraph">
<p>Git místo pouhého přesunutí ukazatele větve vpřed, tentokrát vytvoří nový snímek, který je výsledkem třícestného slučování, a automaticky vytvoří nový objekt revize, který jej zachycuje.
Říká se mu bod sloučení (merge commit) a je zvláštní v tom, že má víc než jednoho rodiče.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="{{< relurl "book/cs/v2/images/basic-merging-2.png" >}}" alt="Bod sloučení.">
</div>
<div class="title">Figure 25. Bod sloučení</div>
</div>
<div class="paragraph">
<p>Za zmínku stojí, že Git určí nejlepšího společného předka, jako základ pro slučování. Tím se liší od starších nástrojů jako CVS nebo Subversion (před verzí 1.5), kde si musel nejlepší základ pro slučování určit sám vývojář, který sloučení prováděl.
Tím se slučování větví v Gitu stává o dost jednodušší, než je tomu v ostatních systémech.</p>
</div>
<div class="paragraph">
<p>Nyní, když jste svou práci začlenili, nebudete už větev <code>iss53</code> potřebovat.
V systému sledování tiketů můžete tento tiket uzavřít a větev můžete smazat:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git branch -d iss53</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h3 id="_basic_merge_conflicts">Základní konflikty při slučování</h3>
<div class="paragraph">
<p>
Občas se stane, že tento proces neproběhne hladce.
Pokud jste tutéž část stejného souboru změnili odlišně ve dvou větvích, které chcete sloučit, Git je nebude umět sloučit čistě.
Pokud se oprava problému #53 týkala stejné části souboru jako větev <code>hotfix</code>, dojde ke konfliktu při slučování (merge conflict), který vypadá nějak takto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git merge iss53
Auto-merging index.html
CONFLICT (content): Merge conflict in index.html
Automatic merge failed; fix conflicts and then commit the result.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Git automaticky nevytvořil nový bod sloučení.
Prozatím pozastavil celý proces do doby, než konflikt vyřešíte.
Chcete-li kdykoli po konfliktu zjistit, které soubory zůstaly nesloučeny, spusťte příkaz <code>git status</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git status
On branch master
You have unmerged paths.
  (fix conflicts and run "git commit")

Unmerged paths:
  (use "git add &lt;file&gt;..." to mark resolution)

    both modified:      index.html

no changes added to commit (use "git add" and/or "git commit -a")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vše, u čeho při slučování vznikl konflikt, který nebyl vyřešen, je označeno jako „unmerged“ (nesloučeno).
Git přidává do souborů způsobujících konflikt standardní značky pro označení konfliktů (conflict-resolution markers), takže soubory můžete ručně otevřít a konflikty vyřešit.
Soubor obsahuje část, která vypadá nějak takto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD:index.html
&lt;div id="footer"&gt;contact : email.support@github.com&lt;/div&gt;
=======
&lt;div id="footer"&gt;
 please contact us at support@github.com
&lt;/div&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; iss53:index.html</code></pre>
</div>
</div>
<div class="paragraph">
<p>To znamená, že verze v <code>HEAD</code> (což je vaše větev <code>master</code>, protože jste na ni byli přepnutí, když jste spouštěli příkaz <code>merge</code>) je uvedena v horní části tohoto bloku (všechno nad oddělovačem <code>=======</code>), zatímco verze z větve <code>iss53</code> je uvedena v dolní části.
Chcete-li vzniklý konflikt vyřešit, musíte buď vybrat jednu z obou možností, nebo je ručně spojit dohromady.
Tento konflikt můžete vyřešit například nahrazením celého bloku tímto textem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div id="footer"&gt;
please contact us at email.support@github.com
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Toto řešení obsahuje trochu z každé části a řádky <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>, <code>=======</code> a <code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code> byly úplně odstraněny.
Po vyřešení všech označených částí ve všech souborech s konfliktem, spusťte pro každý soubor příkaz <code>git add</code>, kterým ho označíte jako vyřešený.
Připravením k zápisu se v Gitu soubor označí jako vyřešený.</p>
</div>
<div class="paragraph">
<p>Chcete-li k vyřešení problémů použít grafický nástroj, můžete použít příkaz <code>git mergetool</code>, který spustí příslušný vizuální nástroj pro slučování, a ten vás všemi konflikty provede:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git mergetool

This message is displayed because 'merge.tool' is not configured.
See 'git mergetool --tool-help' or 'git help config' for more details.
'git mergetool' will now attempt to use one of the following tools:
opendiff kdiff3 tkdiff xxdiff meld tortoisemerge gvimdiff diffuse diffmerge ecmerge p4merge araxis bc3 codecompare vimdiff emerge
Merging:
index.html

Normal merge conflict for 'index.html':
  {local}: modified file
  {remote}: modified file
Hit return to start merge resolution tool (opendiff):</code></pre>
</div>
</div>
<div class="paragraph">
<p>Česky: Tato zpráva se zobrazila, protože hodnota <code>'merge.tool'</code> (nástroj pro slučování) není nakonfigurována…​ a následuje návod ke spuštění nápovědy. Dále…​ <code>'git mergetool'</code> se nyní pokusí spustit jeden z následujících nástrojů: …​ Následuje informace o souboru s konfliktem a končí to…​ Stiskněte klávesu Return (Enter) pro spuštění opendiff.</p>
</div>
<div class="paragraph">
<p>Chcete-li pro slučování použít jiný než výchozí nástroj (Git v tomto případě vybral <code>opendiff</code>, protože byl příkaz spuštěn v systému Mac), naleznete všechny podporované nástroje na začátku výstupu v části „one of the following tools:“ („jeden z možných nástrojů“). Jednoduše napište jméno nástroje, který byste použili raději.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Pokud pro řešení zapeklitých konfliktů potřebujete pokročilejší nástroje, podívejte se na podkapitolu <a href="{{< relurl "book/cs/v2/ch00/_advanced_merging" >}}">Advanced Merging</a>, která se slučováním zabývá podrobněji.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Po zavření nástroje pro slučování se vás Git zeptá, zda sloučení proběhlo úspěšně.
Pokud skriptu oznámíte, že ano, připraví soubor k zapsání a tím ho označí jako vyřešený.
Ještě jednou můžete spustit příkaz <code>git status</code>, abyste si ověřili, že byly všechny konflikty vyřešeny:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git status
On branch master
All conflicts fixed but you are still merging.
  (use "git commit" to conclude merge)

Changes to be committed:

    modified:   index.html</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pokud jste s výsledkem spokojeni a ujistili jste se, že všechny soubory s konfliktem jsou připraveny k zapsání, můžete zadat příkaz <code>git commit</code> a dokončit vytvoření bodu sloučení (merge commit).
Zpráva k revizi má v takovém případě přednastavenu tuto podobu:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">Merge branch 'iss53'

Conflicts:
    index.html
#
# It looks like you may be committing a merge.
# If this is not correct, please remove the file
#	.git/MERGE_HEAD
# and try again.


# Please enter the commit message for your changes. Lines starting
# with '#' will be ignored, and an empty message aborts the commit.
# On branch master
# All conflicts fixed but you are still merging.
#
# Changes to be committed:
#	modified:   index.html
#</code></pre>
</div>
</div>
<div class="paragraph">
<p>Není-li zcela zřejmé co a proč jste udělali, můžete zprávu doplnit o detaily, jak jste konflikt vyřešili — pokud si myslíte, že by to v budoucnu mohlo při zkoumání obsahu této revize vzniklé sloučením nějak pomoci.</p>
</div>
</div>
<div id="nav"><a href="{{< previous-section >}}">prev</a> | <a href="{{< next-section >}}">next</a></div>