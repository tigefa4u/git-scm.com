---
### DO NOT EDIT! Generated by script/update-book2.rb
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: cs
  chapter:
    title: Git na serveru
    number: 4
  section:
    title: Démon Git
    number: 5
    cs_number: '4.5'
    previous: book/cs/v2/Git-na-serveru-Nastavení-serveru
    next: book/cs/v2/Git-na-serveru-Chytrý-HTTP
title: Git - Démon Git
url: "/book/cs/v2/Git-na-serveru-Démon-Git.html"
---
<h2 id="_démon_git">Démon Git</h2>
<div class="paragraph">
<p>
Dále si zřídíme si démona pro obsluhu repozitářů přes protokol „Git“.
Jde o obvyklou volbu, pokud potřebujeme rychlý přístup ke gitovým datům bez nutnosti autentizace.
Pamatujte na to, že se jedná o službu bez ověřování totožnosti, a proto vše, co budete tímto protokolem obsluhovat, bude uvnitř sítě pokládáno za veřejné.</p>
</div>
<div class="paragraph">
<p>Pokud protokol používáte na serveru mimo firewall, měl by být použit pouze pro projekty, které jsou veřejně viditelné okolnímu světu.
Pokud je server, na kterém protokol provozujete, uvnitř firewallu, můžete ho používat u projektů, k nimž má mít velký počet lidí nebo počítačů přístup pouze pro čtení (servery průběžné integrace nebo servery sestavení) a nechcete pro každého z nich přidávat SSH klíč.</p>
</div>
<div class="paragraph">
<p>Na protokolu Git každopádně oceníte jeho snadné nastavení.
V podstatě je třeba následujícím příkazem spustit gitového démona:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git daemon --reuseaddr --base-path=/opt/git/ /opt/git/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Volba <code>--reuseaddr</code> umožňuje serveru restartování bez nutnosti čekat na vypršení časového limitu pro stará spojení, volba <code>--base-path</code> umožňuje uživatelům klonovat projekty, aniž by museli zadávat celou cestu, a cesta na konci příkazu říká démonu Git, kde má hledat repozitáře určené k exportu.
Jestliže používáte bránu firewall, budete do ní muset na daném počítači provrtat díru pro port 9418.</p>
</div>
<div class="paragraph">
<p>Proces démona můžete spustit mnoha způsoby — v závislosti na tom, jaký operační systém používáte.
U počítačů s Ubuntu můžete použít skript Upstart.
Do souboru</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">/etc/init/local-git-daemon.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>vložte tento skript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">start on startup
stop on shutdown
exec /usr/bin/git daemon \
    --user=git --group=git \
    --reuseaddr \
    --base-path=/opt/git/ \
    /opt/git/
respawn</code></pre>
</div>
</div>
<div class="paragraph">
<p>Z bezpečnostních důvodů důrazně doporučujeme, aby byl tento démon spuštěn jako uživatel, který má k repozitářům oprávnění pouze pro čtení. To lze snadno zajistit vytvořením nového uživatele <code>git-ro</code> a spuštěním démona s jeho oprávněními.
Pro zjednodušení jej prostě spustíme pod stejným uživatelem <code>git</code>, pod kterým běží <code>git-shell</code>.</p>
</div>
<div class="paragraph">
<p>Při restartování počítače se gitový démon spustí automaticky. V případě pádu démona bude jeho činnost automaticky obnovena (respawn).
Pokud ho chcete spustit aniž byste museli počítač restartovat, použijte následující příkaz:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ initctl start local-git-daemon</code></pre>
</div>
</div>
<div class="paragraph">
<p>V jiných systémech možná budete chtít použít <code>xinetd</code>, skript systému <code>sysvinit</code>, nebo nějaký podobný skript — umožní-li vám dosáhnout démonizovaného příkazu, který je nějak hlídán.</p>
</div>
<div class="paragraph">
<p>Dále musíte Gitu říct, ke kterým repozitářům povolíte neautentizovaný přístup přes gitový server.
Můžete to udělat tak, že v každém repozitáři vytvoříte soubor pojmenovaný <code>git-daemon-export-ok</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cd /path/to/project.git
$ touch git-daemon-export-ok</code></pre>
</div>
</div>
<div class="paragraph">
<p>Přítomnost tohoto souboru Gitu sděluje, že obsluha daného projektu nevyžaduje ověřování totožnosti.</p>
</div>
<div id="nav"><a href="{{< previous-section >}}">prev</a> | <a href="{{< next-section >}}">next</a></div>